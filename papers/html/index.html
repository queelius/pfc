<!DOCTYPE html><html lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>PFC: Zero-Copy Data Compression Through Prefix-Free Codecs and Generic Programming</title>
<!--Generated on Wed Oct  1 23:11:14 2025 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<!--Document created on October 1, 2025.-->

<link rel="stylesheet" href="LaTeXML.css" type="text/css">
<link rel="stylesheet" href="ltx-article.css" type="text/css">
<link rel="stylesheet" href="ltx-listings.css" type="text/css">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<style>

/* Container for component positioning */
.tex2any-content-wrapper {
    position: relative;
    min-height: 100vh;
}

</style>
<meta name="tex2any-footer-config" content='{"author_name": "Alex Towell", "author_email": "lex@metafunctor.com", "copyright_year": "2025", "license": "CC BY 4.0", "custom_text": ""}'>
<style>
/* Theme: academic */
/* Academic Theme - Beautiful, minimalistic, excellent readability */

:root {
    /* Typography */
    --font-body: 'Charter', 'Bitstream Charter', 'Georgia', 'Times New Roman', serif;
    --font-headings: system-ui, -apple-system, 'Segoe UI', sans-serif;
    --font-mono: 'Menlo', 'Monaco', 'Courier New', monospace;

    /* Colors - Sophisticated academic palette */
    --color-text: #2d2d2d;
    --color-bg: #ffffff;
    --color-accent: #1a5490;
    --color-accent-light: #2e6ba8;
    --color-muted: #5a5a5a;
    --color-border: #d0d0d0;
    --color-surface: #f9f9f9;
    --color-surface-alt: #f4f4f4;

    /* Layout */
    --max-width: 50rem;  /* ~800px, better for modern screens */
    --max-width-wide: 75rem;
    --spacing-unit: 2rem;
    --content-padding: 3rem;

    /* Responsive font sizes */
    --font-size-base: 1.125rem;  /* 18px */
    --line-height-base: 1.75;

    /* Component colors (for theme integration) */
    --link-color: var(--color-accent);
    --link-hover-color: var(--color-accent-light);
    --toc-bg: var(--color-surface);
    --toc-border: var(--color-border);
    --header-bg: var(--color-bg);
    --header-border: var(--color-border);
    --footer-bg: var(--color-surface);
    --footer-border: var(--color-border);
}

* {
    box-sizing: border-box;
}

/* Base typography */
body {
    max-width: var(--max-width);
    margin: 0 auto;
    padding: var(--content-padding) var(--spacing-unit);
    line-height: var(--line-height-base);
    font-family: var(--font-body);
    font-size: var(--font-size-base);
    color: var(--color-text);
    background: var(--color-bg);
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* Headings */
h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-headings);
    line-height: 1.25;
    font-weight: 600;
    letter-spacing: -0.02em;
    margin-top: 3rem;
    margin-bottom: 1.25rem;
    color: var(--color-text);
}

h1 {
    font-size: 2.5rem;
    margin-top: 0;
    font-weight: 700;
}

h2 {
    font-size: 1.875rem;
    margin-top: 3.5rem;
    padding-bottom: 0.75rem;
    border-bottom: 2px solid var(--color-border);
}

h3 {
    font-size: 1.5rem;
    margin-top: 2.5rem;
}

h4 {
    font-size: 1.25rem;
    font-weight: 600;
}

h5, h6 {
    font-size: 1.125rem;
    font-weight: 600;
}

/* Links */
a {
    color: var(--color-accent);
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: all 0.15s ease;
}

a:hover {
    color: var(--color-accent-light);
    border-bottom-color: currentColor;
}

/* Paragraphs */
p {
    margin: 1.25rem 0;
    hyphens: auto;
    -webkit-hyphens: auto;
}

/* First paragraph after heading - no top margin */
h1 + p, h2 + p, h3 + p, h4 + p {
    margin-top: 0.75rem;
}

/* Lists */
ul, ol {
    margin: 1rem 0;
    padding-left: 2rem;
}

li {
    margin: 0.5rem 0;
}

/* LaTeXML Document Structure */
.ltx_document {
    margin: 0;
}

.ltx_title {
    font-family: var(--font-headings);
    font-size: 3rem;
    font-weight: 700;
    line-height: 1.15;
    margin-bottom: 1.5rem;
    margin-top: 2rem;
    letter-spacing: -0.03em;
    color: var(--color-text);
}

.ltx_authors {
    font-size: 1.25rem;
    margin-bottom: 0.75rem;
    color: var(--color-muted);
    font-weight: 400;
}

.ltx_author {
    display: inline-block;
}

.ltx_author:not(:last-child)::after {
    content: ', ';
}

.ltx_date {
    font-size: 1.0625rem;
    color: var(--color-muted);
    margin-bottom: 3rem;
    font-style: italic;
}

/* Abstract */
.ltx_abstract {
    margin: 3rem 0;
    padding: 2rem 2.5rem;
    background: var(--color-surface);
    border-left: 4px solid var(--color-accent);
    border-radius: 4px;
    font-size: 1.0625rem;
    line-height: 1.7;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}

.ltx_abstract .ltx_title {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 1.25rem;
    margin-top: 0;
    color: var(--color-text);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-size: 0.95rem;
}

/* Sections */
.ltx_section {
    margin-top: 3rem;
}

/* Equations */
.ltx_equation {
    margin: 2rem 0;
    overflow-x: auto;
    padding: 1rem 0;
}

.ltx_eqn_number {
    float: right;
    font-family: var(--font-mono);
    font-size: 0.9rem;
    color: var(--color-muted);
}

.ltx_Math {
    font-size: 1.05em;
}

/* Theorems, Definitions, Proofs */
.ltx_theorem, .ltx_proof, .ltx_definition, .ltx_lemma, .ltx_corollary {
    margin: 2rem 0;
    padding: 1.5rem;
    background: var(--color-surface);
    border-left: 3px solid var(--color-accent);
    border-radius: 2px;
}

.ltx_theorem .ltx_title,
.ltx_proof .ltx_title,
.ltx_definition .ltx_title,
.ltx_lemma .ltx_title,
.ltx_corollary .ltx_title {
    font-family: var(--font-headings);
    font-size: 1rem;
    font-weight: 600;
    font-style: italic;
    color: var(--color-accent);
    margin-bottom: 0.75rem;
}

.ltx_proof {
    border-left-color: var(--color-muted);
}

.ltx_proof .ltx_title {
    color: var(--color-muted);
}

/* Figures and Images */
figure, .ltx_figure {
    margin: 2.5rem 0;
    text-align: center;
}

figcaption, .ltx_caption {
    margin-top: 0.75rem;
    font-size: 0.95rem;
    font-style: italic;
    color: var(--color-muted);
    text-align: center;
}

img {
    max-width: 100%;
    height: auto;
    border-radius: 2px;
}

/* Tables */
.ltx_table {
    margin: 2.5rem 0;
    overflow-x: auto;
}

table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.95rem;
}

th, td {
    padding: 0.75rem 1rem;
    text-align: left;
    border-bottom: 1px solid var(--color-border);
}

th {
    font-weight: 600;
    background: var(--color-surface);
    border-bottom: 2px solid var(--color-accent);
}

tbody tr:hover {
    background: var(--color-surface-alt);
}

/* Code */
code, .ltx_verbatim {
    font-family: var(--font-mono);
    font-size: 0.875em;
    background: var(--color-surface);
    padding: 0.2em 0.4em;
    border-radius: 3px;
    border: 1px solid var(--color-border);
}

pre, .ltx_lstlisting {
    font-family: var(--font-mono);
    font-size: 0.875em;
    background: var(--color-surface);
    padding: 1.25rem;
    border-radius: 4px;
    border: 1px solid var(--color-border);
    overflow-x: auto;
    line-height: 1.5;
    margin: 1.5rem 0;
}

pre code {
    background: none;
    border: none;
    padding: 0;
}

/* Bibliography */
.ltx_bibliography {
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 2px solid var(--color-border);
}

.ltx_bibliography .ltx_title {
    font-size: 1.75rem;
    margin-bottom: 1.5rem;
}

.ltx_bibitem {
    margin-bottom: 1rem;
    padding-left: 2rem;
    text-indent: -2rem;
}

.ltx_bib_author {
    font-weight: 600;
}

.ltx_bib_title {
    font-style: italic;
}

/* Footnotes */
.ltx_note {
    font-size: 0.9rem;
    margin-top: 3rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--color-border);
}

/* References and citations */
.ltx_ref {
    color: var(--color-accent);
    font-weight: 500;
}

.ltx_cite {
    color: var(--color-accent);
}

/* Table of Contents */
.ltx_TOC {
    margin: 2.5rem 0;
    padding: 1.75rem;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 4px;
}

.ltx_TOC .ltx_title {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 1rem;
}

.ltx_TOC ul {
    list-style: none;
    padding-left: 0;
}

.ltx_TOC li {
    margin: 0.5rem 0;
}

.ltx_TOC li li {
    padding-left: 1.5rem;
    margin: 0.3rem 0;
}

.ltx_TOC a {
    color: var(--color-accent);
}

/* Print styles */
@media print {
    body {
        font-size: 11pt;
        line-height: 1.5;
    }

    a {
        color: var(--color-text);
        text-decoration: none;
        border-bottom: none;
    }

    h2, h3 {
        page-break-after: avoid;
    }

    figure, .ltx_figure, .ltx_table {
        page-break-inside: avoid;
    }
}

/* Add subtle page background for better visual separation */
body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(to bottom, #fafafa 0%, #ffffff 100%);
    z-index: -1;
    pointer-events: none;
}

/* Dark mode gradient background */
body[data-theme="dark"]::before {
    background: linear-gradient(to bottom, #1a1a1a 0%, #0d0d0d 100%);
}

/* Responsive adjustments */
@media (max-width: 768px) {
    :root {
        --font-size-base: 1rem;
        --spacing-unit: 1rem;
        --content-padding: 1.5rem;
    }

    body {
        padding: var(--content-padding) var(--spacing-unit);
    }

    .ltx_title {
        font-size: 2rem;
    }

    h1 {
        font-size: 1.75rem;
    }

    h2 {
        font-size: 1.5rem;
    }

    h3 {
        font-size: 1.25rem;
    }

    .ltx_abstract {
        padding: 1.5rem;
    }
}

/* Component: reading-time */
/* Reading Time Component - Estimated reading time display */
/* Shows at the top of the document, near the title */

.tex2any-reading-time {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: var(--toggle-bg, rgba(255, 255, 255, 0.95));
    border: 1px solid var(--toggle-border, #d0d0d0);
    border-radius: 20px;
    font-size: 0.9rem;
    font-family: var(--font-sans, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif);
    color: var(--text-color, #1a1a1a);
    margin: 1rem 0;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.tex2any-reading-time svg {
    width: 18px;
    height: 18px;
    fill: currentColor;
    opacity: 0.7;
}

.tex2any-reading-time-text {
    font-weight: 500;
}

/* Position near title if .ltx_title exists */
.ltx_title + .tex2any-reading-time,
h1 + .tex2any-reading-time {
    margin-top: 0.5rem;
}

/* Alternative: floating position in top-right */
.tex2any-reading-time.floating {
    position: absolute;
    top: 20px;
    right: 20px;
    margin: 0;
    z-index: 100;
}

/* When used with header components, adjust position */
.tex2any-reading-time.in-header {
    position: static;
    margin: 0;
}

/* Progress indicator (optional enhancement) */
.tex2any-reading-time-progress {
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-right: 0.25rem;
    transition: background-color 0.3s ease;
}

.tex2any-reading-time-progress.not-started {
    background-color: #e0e0e0;
}

.tex2any-reading-time-progress.in-progress {
    background-color: #ffc107;
}

.tex2any-reading-time-progress.completed {
    background-color: #4caf50;
}

/* Dark mode adjustments */
body[data-theme="dark"] .tex2any-reading-time {
    background: var(--color-surface, rgba(42, 42, 42, 0.95));
    border-color: var(--color-border, #404040);
    color: var(--color-text, #e4e4e4);
}

body[data-theme="dark"] .tex2any-reading-time-progress.not-started {
    background-color: #404040;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .tex2any-reading-time {
        font-size: 0.85rem;
        padding: 0.4rem 0.8rem;
    }

    .tex2any-reading-time.floating {
        top: 10px;
        right: 10px;
    }

    .tex2any-reading-time svg {
        width: 16px;
        height: 16px;
    }
}

/* Animation on load */
@keyframes fadeInSlide {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.tex2any-reading-time {
    animation: fadeInSlide 0.5s ease-out;
}

/* Tooltip for detailed info */
.tex2any-reading-time::after {
    content: attr(data-tooltip);
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 8px;
    padding: 0.5rem 0.75rem;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    font-size: 0.8rem;
    border-radius: 4px;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
    z-index: 10;
}

.tex2any-reading-time:hover::after {
    opacity: 1;
}

body[data-theme="dark"] .tex2any-reading-time::after {
    background: rgba(255, 255, 255, 0.9);
    color: black;
}

/* Accessibility */
.tex2any-reading-time:focus-visible {
    outline: 2px solid var(--link-color, #0066cc);
    outline-offset: 2px;
}

/* Component: footer */
/* Footer Component */

.tex2any-footer {
    background: var(--footer-bg, #f8f8f8);
    border-top: 1px solid var(--footer-border, #e0e0e0);
    padding: 2rem;
    margin-top: 4rem;
    font-size: 0.9rem;
    color: var(--footer-text-color, #666);
}

.tex2any-footer-content {
    max-width: var(--max-width, 1200px);
    margin: 0 auto;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 2rem;
}

.tex2any-footer-section h3 {
    font-size: 1rem;
    font-weight: 600;
    margin: 0 0 0.75rem 0;
    color: var(--footer-heading-color, #1a1a1a);
}

.tex2any-footer-section ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.tex2any-footer-section li {
    margin-bottom: 0.5rem;
}

.tex2any-footer-section a {
    color: var(--footer-link-color, #0066cc);
    text-decoration: none;
    transition: color 0.2s;
}

.tex2any-footer-section a:hover {
    color: var(--footer-link-hover, #0052a3);
    text-decoration: underline;
}

.tex2any-footer-bottom {
    max-width: var(--max-width, 1200px);
    margin: 2rem auto 0;
    padding-top: 1.5rem;
    border-top: 1px solid var(--footer-border, #e0e0e0);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
}

.tex2any-footer-copyright {
    color: var(--footer-copyright-color, #999);
}

.tex2any-footer-links {
    display: flex;
    gap: 1.5rem;
}

@media (max-width: 768px) {
    .tex2any-footer-content {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }

    .tex2any-footer-bottom {
        flex-direction: column;
        text-align: center;
    }
}

/* Component: floating-toc */
/* Floating TOC Component - Left sidebar navigation */
/* Works within a container, not fixed to viewport */

.tex2any-floating-toc {
    position: absolute;
    left: 0;
    top: 0;
    width: 280px;
    height: 100%;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 2rem 1.5rem;
    background: var(--toc-bg, #f8f8f8);
    border-right: 1px solid var(--toc-border, #ddd);
    font-size: 0.9rem;
    z-index: 100;
    transition: transform 0.3s ease;
}

.tex2any-floating-toc.collapsed {
    transform: translateX(-100%);
}

.tex2any-floating-toc-toggle {
    position: absolute;
    left: 10px;
    top: 10px;
    z-index: 101;
    padding: 0.5rem 0.75rem;
    background: var(--toc-toggle-bg, #ffffff);
    border: 1px solid var(--toc-border, #ddd);
    border-radius: 4px;
    cursor: pointer;
    font-size: 1.2rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: all 0.2s;
}

.tex2any-floating-toc-toggle:hover {
    background: var(--toc-toggle-hover, #f0f0f0);
}

.tex2any-floating-toc .tex2any-toc-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: var(--text-color, #1a1a1a);
}

.tex2any-floating-toc ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}

.tex2any-floating-toc li {
    margin: 0.3rem 0;
}

.tex2any-floating-toc li li {
    padding-left: 1rem;
}

.tex2any-floating-toc li li li {
    padding-left: 2rem;
}

.tex2any-floating-toc a {
    display: block;
    padding: 0.4rem 0.6rem;
    border-radius: 4px;
    transition: all 0.2s;
    color: var(--link-color, #0066cc);
    text-decoration: none;
}

.tex2any-floating-toc a:hover {
    background: var(--toc-hover-bg, rgba(0, 102, 204, 0.1));
}

.tex2any-floating-toc a.active {
    background: var(--toc-active-bg, rgba(0, 102, 204, 0.15));
    font-weight: 500;
}

/* TOC is an overlay - doesn't affect main content layout at all */
body.has-floating-toc {
    /* No layout changes - TOC floats on top */
}

/* Smooth scrolling */
html {
    scroll-behavior: smooth;
}

/* Responsive: hide TOC on small screens */
@media (max-width: 1024px) {
    .tex2any-floating-toc {
        transform: translateX(-100%);
    }

    .tex2any-floating-toc.show {
        transform: translateX(0);
        box-shadow: 2px 0 8px rgba(0,0,0,0.2);
    }

    body.has-floating-toc {
        margin-left: 0;
    }
}
</style>
</head>
<body>
<div class="tex2any-content-wrapper">
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line">
<h1 class="ltx_title ltx_font_bold ltx_title_document">PFC: Zero-Copy Data Compression Through
<br class="ltx_break">Prefix-Free Codecs and Generic Programming</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">
PFC Library Authors
<br class="ltx_break"><span class="ltx_text ltx_font_typewriter">https://github.com/spinoza/pfc</span>
</span></span>
</div>
<div class="ltx_dates">(October 1, 2025)</div>

<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract</h6>
<p class="ltx_p">We present PFC (Prefix-Free Codecs), a header-only C++20 library that achieves full-featured data compression without marshaling overhead through a novel combination of prefix-free codes and generic programming principles. The library implements a <em class="ltx_emph ltx_font_italic">zero-copy invariant</em>: in-memory representation equals wire representation, eliminating the traditional separation between compressed storage and runtime values. By building on universal coding theory and Stepanov’s generic programming methodology, PFC provides a complete algebraic type system with sum types, product types, and recursive structures, all maintained in compressed form. The library demonstrates that modern C++ concepts and template metaprogramming enable elegant composition of compression schemes while maintaining zero runtime overhead. We achieve compression ratios of 3.3 bits per value for geometric distributions while supporting full STL integration, random access, and type-safe polymorphism.</p>
</div>
<section id="S1" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1 </span>Introduction</h2>

<div id="S1.p1" class="ltx_para">
<p class="ltx_p">Data compression and program efficiency have traditionally existed in tension. Compressed data must be decompressed before use, creating a fundamental trade-off between storage efficiency and runtime performance. Applications typically choose between keeping data uncompressed in memory (wasting space) or compressing it (paying decompression costs on every access). This dichotomy stems from a deeper assumption: that compressed and uncompressed representations must be distinct.</p>
</div>
<div id="S1.p2" class="ltx_para">
<p class="ltx_p">We challenge this assumption through <em class="ltx_emph ltx_font_italic">prefix-free codes</em>—self-delimiting encodings that enable direct composition without external metadata. Combined with modern C++20 concepts and zero-cost abstractions, this foundation supports a complete programming model where compression is not an external concern but an intrinsic property of types.</p>
</div>
<section id="S1.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">1.1 </span>Contributions</h3>

<div id="S1.SS1.p1" class="ltx_para">
<p class="ltx_p">This work makes the following contributions:</p>
</div>
<div id="S1.SS1.p2" class="ltx_para">
<ol id="S1.I1" class="ltx_enumerate">
<li id="S1.I1.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">1.</span> 
<div id="S1.I1.i1.p1" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Zero-copy invariant architecture</span>: A design where in-memory bytes equal wire bytes, eliminating marshaling overhead entirely.</p>
</div>
</li>
<li id="S1.I1.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">2.</span> 
<div id="S1.I1.i2.p1" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Complete algebraic type system</span>: Full support for product types (tuples), sum types (variants), optional values, and recursive structures, all maintained in compressed form.</p>
</div>
</li>
<li id="S1.I1.i3" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">3.</span> 
<div id="S1.I1.i3.p1" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Generic programming methodology</span>: A concepts-based architecture following Stepanov’s principles of regular types, value semantics, and algorithmic abstraction.</p>
</div>
</li>
<li id="S1.I1.i4" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">4.</span> 
<div id="S1.I1.i4.p1" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">STL integration</span>: Proxy iterators and type-erased containers that work seamlessly with standard algorithms while maintaining zero-copy semantics.</p>
</div>
</li>
<li id="S1.I1.i5" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">5.</span> 
<div id="S1.I1.i5.p1" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Comprehensive codec library</span>: Universal codes (Elias Gamma/Delta/Omega, Fibonacci, Rice), numeric types (configurable floating point, rationals, complex numbers), and composite encodings.</p>
</div>
</li>
</ol>
</div>
</section>
<section id="S1.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">1.2 </span>Design Philosophy</h3>

<div id="S1.SS2.p1" class="ltx_para">
<p class="ltx_p">PFC follows Alex Stepanov’s generic programming principles from <em class="ltx_emph ltx_font_italic">Elements of Programming</em> <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib1" title="" class="ltx_ref">1</a>]</cite>:</p>
</div>
<div id="S1.SS2.p2" class="ltx_para">
<ul id="S1.I2" class="ltx_itemize">
<li id="S1.I2.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S1.I2.i1.p1" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Regular types</span>: All types are copyable, assignable, and comparable with expected semantics.</p>
</div>
</li>
<li id="S1.I2.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S1.I2.i2.p1" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Value semantics</span>: Objects behave like mathematical values, not references or pointers.</p>
</div>
</li>
<li id="S1.I2.i3" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S1.I2.i3.p1" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Algebraic structure</span>: Types form algebras with well-defined composition operations.</p>
</div>
</li>
<li id="S1.I2.i4" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S1.I2.i4.p1" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Algorithmic abstraction</span>: Algorithms are independent of data structures through concepts.</p>
</div>
</li>
<li id="S1.I2.i5" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S1.I2.i5.p1" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Zero-cost abstractions</span>: Template metaprogramming provides abstraction without runtime overhead.</p>
</div>
</li>
</ul>
</div>
<div id="S1.SS2.p3" class="ltx_para">
<p class="ltx_p">The zero-copy invariant emerges naturally from these principles. If compression is a property of types rather than an external operation, and if all operations preserve value semantics, then the compressed representation <em class="ltx_emph ltx_font_italic">is</em> the value.</p>
</div>
</section>
</section>
<section id="S2" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2 </span>Prefix-Free Codes as Foundation</h2>

<div id="S2.p1" class="ltx_para">
<p class="ltx_p">The cornerstone of our approach is the <em class="ltx_emph ltx_font_italic">self-delimiting property</em> of prefix-free codes. A code is prefix-free if no codeword is a prefix of another. This property enables sequential decoding without delimiters: the decoder can identify codeword boundaries by examining the bit sequence alone.</p>
</div>
<section id="S2.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.1 </span>Universal Coding Theory</h3>

<div id="S2.SS1.p1" class="ltx_para">
<p class="ltx_p">Universal codes <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib2" title="" class="ltx_ref">2</a>, <a href="#bib.bib3" title="" class="ltx_ref">3</a>]</cite> provide asymptotically optimal encoding for integers without prior knowledge of the distribution. The library implements several fundamental schemes:</p>
</div>
<div id="S2.SS1.p2" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Elias Gamma</span>: For positive integer <math id="S2.SS1.p2.m1" class="ltx_Math" alttext="n" display="inline"><mi>n</mi></math>, write <math id="S2.SS1.p2.m2" class="ltx_Math" alttext="n" display="inline"><mi>n</mi></math> in binary as <math id="S2.SS1.p2.m3" class="ltx_Math" alttext="1b_{k-1}\ldots b_{0}" display="inline"><mrow><mn>1</mn><mo>⁢</mo><msub><mi>b</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>⁢</mo><mi mathvariant="normal">…</mi><mo>⁢</mo><msub><mi>b</mi><mn>0</mn></msub></mrow></math> where <math id="S2.SS1.p2.m4" class="ltx_Math" alttext="k=\lfloor\log_{2}n\rfloor+1" display="inline"><mrow><mi>k</mi><mo>=</mo><mrow><mrow><mo stretchy="false">⌊</mo><mrow><msub><mi>log</mi><mn>2</mn></msub><mo lspace="0.167em">⁡</mo><mi>n</mi></mrow><mo stretchy="false">⌋</mo></mrow><mo>+</mo><mn>1</mn></mrow></mrow></math>. The encoding is <math id="S2.SS1.p2.m5" class="ltx_Math" alttext="(k-1)" display="inline"><mrow><mo stretchy="false">(</mo><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow><mo stretchy="false">)</mo></mrow></math> zeros followed by the binary representation. This requires <math id="S2.SS1.p2.m6" class="ltx_Math" alttext="2\lfloor\log_{2}n\rfloor+1" display="inline"><mrow><mrow><mn>2</mn><mo>⁢</mo><mrow><mo stretchy="false">⌊</mo><mrow><msub><mi>log</mi><mn>2</mn></msub><mo lspace="0.167em">⁡</mo><mi>n</mi></mrow><mo stretchy="false">⌋</mo></mrow></mrow><mo>+</mo><mn>1</mn></mrow></math> bits.</p>
</div>
<div id="S2.SS1.p3" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Elias Delta</span>: Improves on Gamma by encoding the length in Gamma code. For <math id="S2.SS1.p3.m1" class="ltx_Math" alttext="n=1b_{k-1}\ldots b_{0}" display="inline"><mrow><mi>n</mi><mo>=</mo><mrow><mn>1</mn><mo>⁢</mo><msub><mi>b</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>⁢</mo><mi mathvariant="normal">…</mi><mo>⁢</mo><msub><mi>b</mi><mn>0</mn></msub></mrow></mrow></math>, encode <math id="S2.SS1.p3.m2" class="ltx_Math" alttext="k-1" display="inline"><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></math> in Gamma, then write <math id="S2.SS1.p3.m3" class="ltx_Math" alttext="b_{k-2}\ldots b_{0}" display="inline"><mrow><msub><mi>b</mi><mrow><mi>k</mi><mo>−</mo><mn>2</mn></mrow></msub><mo>⁢</mo><mi mathvariant="normal">…</mi><mo>⁢</mo><msub><mi>b</mi><mn>0</mn></msub></mrow></math>. This achieves <math id="S2.SS1.p3.m4" class="ltx_Math" alttext="\log_{2}n+2\log_{2}\log_{2}n+O(1)" display="inline"><mrow><mrow><msub><mi>log</mi><mn>2</mn></msub><mo lspace="0.167em">⁡</mo><mi>n</mi></mrow><mo>+</mo><mrow><mn>2</mn><mo lspace="0.167em">⁢</mo><mrow><msub><mi>log</mi><mn>2</mn></msub><mo lspace="0.167em">⁡</mo><mrow><msub><mi>log</mi><mn>2</mn></msub><mo lspace="0.167em">⁡</mo><mi>n</mi></mrow></mrow></mrow><mo>+</mo><mrow><mi>O</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mrow></mrow></math> bits.</p>
</div>
<div id="S2.SS1.p4" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Fibonacci</span>: Based on Zeckendorf’s theorem that every positive integer has a unique representation as a sum of non-consecutive Fibonacci numbers. The encoding uses the corresponding bit pattern terminated by two consecutive ones.</p>
</div>
<div id="S2.SS1.p5" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Rice/Golomb</span>: Parametric codes optimal for geometric distributions with parameter <math id="S2.SS1.p5.m1" class="ltx_Math" alttext="p=2^{-k}" display="inline"><mrow><mi>p</mi><mo>=</mo><msup><mn>2</mn><mrow><mo>−</mo><mi>k</mi></mrow></msup></mrow></math>. For parameter <math id="S2.SS1.p5.m2" class="ltx_Math" alttext="k" display="inline"><mi>k</mi></math>, encode <math id="S2.SS1.p5.m3" class="ltx_Math" alttext="n=qk+r" display="inline"><mrow><mi>n</mi><mo>=</mo><mrow><mrow><mi>q</mi><mo>⁢</mo><mi>k</mi></mrow><mo>+</mo><mi>r</mi></mrow></mrow></math> as unary <math id="S2.SS1.p5.m4" class="ltx_Math" alttext="q" display="inline"><mi>q</mi></math> followed by binary <math id="S2.SS1.p5.m5" class="ltx_Math" alttext="r" display="inline"><mi>r</mi></math> in <math id="S2.SS1.p5.m6" class="ltx_Math" alttext="k" display="inline"><mi>k</mi></math> bits.</p>
</div>
</section>
<section id="S2.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.2 </span>Compositional Properties</h3>

<div id="S2.SS2.p1" class="ltx_para">
<p class="ltx_p">The critical property enabling our architecture is that prefix-free codes compose: the concatenation of two prefix-free encodings is itself prefix-free. This allows arbitrary nesting without delimiters:</p>
</div>
<div id="S2.SS2.p2" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,Ly8gQSBwYWlyIG9mIGludGVnZXJzIGVuY29kZXMgYXMgY29uY2F0ZW5hdGVkIGJpdCBzdHJlYW1zCmVuY29kZShwYWlyKDQyLCAxNyksIHNpbmspOwovLyBEZWNvZGVyIGNhbiBzZXBhcmF0ZSB3aXRob3V0IGRlbGltaXRlcnM6CmF1dG8gW2EsIGJdID0gZGVjb2RlPHBhaXI8aW50LGludD4+KHNvdXJjZSk7" download="">⬇</a></div>
<div id="lstnumberx1" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>A<span class="ltx_text ltx_lst_space"> </span>pair<span class="ltx_text ltx_lst_space"> </span>of<span class="ltx_text ltx_lst_space"> </span>integers<span class="ltx_text ltx_lst_space"> </span>encodes<span class="ltx_text ltx_lst_space"> </span>as<span class="ltx_text ltx_lst_space"> </span>concatenated<span class="ltx_text ltx_lst_space"> </span>bit<span class="ltx_text ltx_lst_space"> </span>streams</span>
</div>
<div id="lstnumberx2" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">pair</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(42,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">17),</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx3" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Decoder<span class="ltx_text ltx_lst_space"> </span>can<span class="ltx_text ltx_lst_space"> </span>separate<span class="ltx_text ltx_lst_space"> </span>without<span class="ltx_text ltx_lst_space"> </span>delimiters:</span>
</div>
<div id="lstnumberx4" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">auto</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">[</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">a</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">b</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">]</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">decode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">pair</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">int</span></span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">int</span></span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;&gt;(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">source</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
</div>
</div>
<div id="S2.SS2.p3" class="ltx_para">
<p class="ltx_p">This compositional property extends to arbitrary type structures, enabling product types, sum types, and recursive definitions while maintaining the zero-copy invariant.</p>
</div>
</section>
</section>
<section id="S3" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3 </span>Core Architecture</h2>

<div id="S3.p1" class="ltx_para">
<p class="ltx_p">The library architecture consists of three orthogonal layers: bit I/O, codecs, and packed values. This separation enables independent evolution and composition.</p>
</div>
<section id="S3.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.1 </span>Bit-Level I/O</h3>

<div id="S3.SS1.p1" class="ltx_para">
<p class="ltx_p">Unlike byte-oriented serialization, prefix-free codes require bit-level operations. The library provides <span class="ltx_text ltx_font_typewriter">BitWriter</span> and <span class="ltx_text ltx_font_typewriter">BitSink</span> abstractions:</p>
</div>
<div id="S3.SS1.p2" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,Y2xhc3MgQml0V3JpdGVyIHsKICAgIHVpbnQ4X3QqIHB0cl87CiAgICB1aW50OF90IGJ5dGVfID0gMDsKICAgIHVpbnQ4X3QgYml0X3Bvc18gPSAwOwpwdWJsaWM6CiAgICB2b2lkIHdyaXRlKGJvb2wgYml0KSBub2V4Y2VwdCB7CiAgICAgICAgYnl0ZV8gfD0gKGJpdCA/IDF1IDogMHUpIDw8IGJpdF9wb3NfOwogICAgICAgIGlmICgrK2JpdF9wb3NfID09IDgpIHsKICAgICAgICAgICAgKnB0cl8rKyA9IGJ5dGVfOwogICAgICAgICAgICBieXRlXyA9IDA7CiAgICAgICAgICAgIGJpdF9wb3NfID0gMDsKICAgICAgICB9CiAgICB9CiAgICAvLyBBZGRpdGlvbmFsIG1ldGhvZHMuLi4KfTs=" download="">⬇</a></div>
<div id="lstnumberx5" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">class</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">BitWriter</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx6" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">uint8_t</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">*</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">ptr_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx7" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">uint8_t</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">byte_</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">0;</span>
</div>
<div id="lstnumberx8" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">uint8_t</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">bit_pos_</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">0;</span>
</div>
<div id="lstnumberx9" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">public</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">:</span>
</div>
<div id="lstnumberx10" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">void</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">write</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">bool</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">bit</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">noexcept</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx11" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">byte_</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">|=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">bit</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">?</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">1</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">u</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">:</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">0</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">u</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;&lt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">bit_pos_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx12" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">if</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(++</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">bit_pos_</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">==</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">8)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx13" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">9</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">            </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">*</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">ptr_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">++</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">byte_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx14" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">10</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">            </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">byte_</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">0;</span>
</div>
<div id="lstnumberx15" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">11</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">            </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">bit_pos_</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">0;</span>
</div>
<div id="lstnumberx16" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">12</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx17" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">13</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx18" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">14</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Additional<span class="ltx_text ltx_lst_space"> </span>methods...</span>
</div>
<div id="lstnumberx19" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">15</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">};</span>
</div>
</div>
</div>
<div id="S3.SS1.p3" class="ltx_para">
<p class="ltx_p">The corresponding <span class="ltx_text ltx_font_typewriter">BitReader</span> maintains symmetry for decoding. Both are zero-overhead abstractions: the compiler typically inlines all operations, producing code equivalent to hand-written bit manipulation.</p>
</div>
</section>
<section id="S3.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.2 </span>Codec Concepts</h3>

<div id="S3.SS2.p1" class="ltx_para">
<p class="ltx_p">Codecs define the transformation between values and bit sequences. The library uses C++20 concepts to specify requirements:</p>
</div>
<div id="S3.SS2.p2" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,dGVtcGxhdGU8dHlwZW5hbWUgQywgdHlwZW5hbWUgVD4KY29uY2VwdCBDb2RlYyA9IHJlcXVpcmVzIHsKICAgIHJlcXVpcmVzIEVuY29kZXI8QywgVCwgQml0V3JpdGVyPjsKICAgIHJlcXVpcmVzIERlY29kZXI8QywgVCwgQml0UmVhZGVyPjsKfTsKCnRlbXBsYXRlPHR5cGVuYW1lIEMsIHR5cGVuYW1lIFQsIHR5cGVuYW1lIFNpbms+CmNvbmNlcHQgRW5jb2RlciA9IEJpdFNpbms8U2luaz4gJiYKICAgIHJlcXVpcmVzKGNvbnN0IFQmIHZhbHVlLCBTaW5rJiBzaW5rKSB7CiAgICAgICAgeyBDOjplbmNvZGUodmFsdWUsIHNpbmspIH0gLT4gc3RkOjpzYW1lX2FzPHZvaWQ+OwogICAgfTs=" download="">⬇</a></div>
<div id="lstnumberx20" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">C</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx21" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">concept</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Codec</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">requires</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx22" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">requires</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Encoder</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">C</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">BitWriter</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;;</span>
</div>
<div id="lstnumberx23" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">requires</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Decoder</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">C</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">BitReader</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;;</span>
</div>
<div id="lstnumberx24" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">};</span>
</div>
<div id="lstnumberx25" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span>
</div>
<div id="lstnumberx26" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">C</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx27" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">concept</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Encoder</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">BitSink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;&amp;</span>
</div>
<div id="lstnumberx28" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">9</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">requires</span></span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">const</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx29" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">10</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">C</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">-&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">same_as</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">void</span></span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;;</span>
</div>
<div id="lstnumberx30" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">11</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">};</span>
</div>
</div>
</div>
<div id="S3.SS2.p3" class="ltx_para">
<p class="ltx_p">Each codec is a stateless type providing static <span class="ltx_text ltx_font_typewriter">encode</span> and <span class="ltx_text ltx_font_typewriter">decode</span> methods. This design enables compile-time composition and eliminates virtual dispatch overhead.</p>
</div>
</section>
<section id="S3.SS3" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.3 </span>Packed Values</h3>

<div id="S3.SS3.p1" class="ltx_para">
<p class="ltx_p">The <span class="ltx_text ltx_font_typewriter">Packed&lt;T, Codec&gt;</span> template wraps a value with its encoding scheme:</p>
</div>
<div id="S3.SS3.p2" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,dGVtcGxhdGU8dHlwZW5hbWUgVCwgdHlwZW5hbWUgQ29kZWM+CmNsYXNzIFBhY2tlZCB7CiAgICBUIHZhbHVlXzsKcHVibGljOgogICAgdXNpbmcgdmFsdWVfdHlwZSA9IFQ7CiAgICB1c2luZyBjb2RlY190eXBlID0gQ29kZWM7CgogICAgZXhwbGljaXQgUGFja2VkKGNvbnN0IFQmIHZhbCkgOiB2YWx1ZV8odmFsKSB7fQoKICAgIHRlbXBsYXRlPHR5cGVuYW1lIFNpbms+CiAgICBzdGF0aWMgdm9pZCBlbmNvZGUoY29uc3QgUGFja2VkJiBwLCBTaW5rJiBzaW5rKSB7CiAgICAgICAgQ29kZWM6OmVuY29kZShwLnZhbHVlXywgc2luayk7CiAgICB9CgogICAgdGVtcGxhdGU8dHlwZW5hbWUgU291cmNlPgogICAgc3RhdGljIFBhY2tlZCBkZWNvZGUoU291cmNlJiBzb3VyY2UpIHsKICAgICAgICByZXR1cm4gUGFja2Vke0NvZGVjOjpkZWNvZGU8VD4oc291cmNlKX07CiAgICB9Cn07" download="">⬇</a></div>
<div id="lstnumberx31" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Codec</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx32" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">class</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Packed</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx33" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx34" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">public</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">:</span>
</div>
<div id="lstnumberx35" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">using</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value_type</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx36" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">using</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">codec_type</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Codec</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx37" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span>
</div>
<div id="lstnumberx38" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">explicit</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Packed</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">const</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">val</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">:</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">val</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{}</span>
</div>
<div id="lstnumberx39" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">9</span>
</div>
<div id="lstnumberx40" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">10</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx41" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">11</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">static</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">void</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">const</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Packed</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">p</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx42" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">12</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Codec</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">p</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx43" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">13</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx44" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">14</span>
</div>
<div id="lstnumberx45" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">15</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Source</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx46" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">16</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">static</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Packed</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">decode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Source</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">source</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx47" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">17</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">return</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Packed</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Codec</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">decode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">source</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)};</span>
</div>
<div id="lstnumberx48" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">18</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx49" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">19</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">};</span>
</div>
</div>
</div>
<div id="S3.SS3.p3" class="ltx_para">
<p class="ltx_p">This design separates the value from its encoding strategy, enabling runtime selection of codecs while maintaining type safety.</p>
</div>
</section>
</section>
<section id="S4" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4 </span>Algebraic Type System</h2>

<div id="S4.p1" class="ltx_para">
<p class="ltx_p">A key innovation is the complete algebraic type system built on prefix-free foundations. Mathematical type theory identifies two fundamental type constructors: products and sums. The library implements both with minimal encoding overhead.</p>
</div>
<section id="S4.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.1 </span>Product Types</h3>

<div id="S4.SS1.p1" class="ltx_para">
<p class="ltx_p">Product types combine multiple values. The <span class="ltx_text ltx_font_typewriter">PackedPair</span> implementation demonstrates the approach:</p>
</div>
<div id="S4.SS1.p2" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,dGVtcGxhdGU8UGFja2VkVmFsdWUgRmlyc3QsIFBhY2tlZFZhbHVlIFNlY29uZD4KY2xhc3MgUGFja2VkUGFpciB7CiAgICBGaXJzdCBmaXJzdF87CiAgICBTZWNvbmQgc2Vjb25kXzsKcHVibGljOgogICAgdGVtcGxhdGU8dHlwZW5hbWUgU2luaz4KICAgIHN0YXRpYyB2b2lkIGVuY29kZShjb25zdCBQYWNrZWRQYWlyJiBwLCBTaW5rJiBzaW5rKSB7CiAgICAgICAgRmlyc3Q6OmVuY29kZShwLmZpcnN0Xywgc2luayk7CiAgICAgICAgU2Vjb25kOjplbmNvZGUocC5zZWNvbmRfLCBzaW5rKTsKICAgIH0KCiAgICB0ZW1wbGF0ZTx0eXBlbmFtZSBTb3VyY2U+CiAgICBzdGF0aWMgUGFja2VkUGFpciBkZWNvZGUoU291cmNlJiBzb3VyY2UpIHsKICAgICAgICByZXR1cm4gUGFja2VkUGFpcnsKICAgICAgICAgICAgRmlyc3Q6OmRlY29kZShzb3VyY2UpLAogICAgICAgICAgICBTZWNvbmQ6OmRlY29kZShzb3VyY2UpCiAgICAgICAgfTsKICAgIH0KfTs=" download="">⬇</a></div>
<div id="lstnumberx50" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedValue</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">First</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedValue</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Second</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx51" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">class</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedPair</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx52" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">First</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">first_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx53" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Second</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">second_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx54" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">public</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">:</span>
</div>
<div id="lstnumberx55" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx56" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">static</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">void</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">const</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedPair</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">p</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx57" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">First</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">p</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">first_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx58" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">9</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Second</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">p</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">second_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx59" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">10</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx60" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">11</span>
</div>
<div id="lstnumberx61" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">12</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Source</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx62" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">13</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">static</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedPair</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">decode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Source</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">source</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx63" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">14</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">return</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedPair</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx64" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">15</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">            </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">First</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">decode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">source</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">),</span>
</div>
<div id="lstnumberx65" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">16</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">            </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Second</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">decode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">source</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span>
</div>
<div id="lstnumberx66" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">17</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">};</span>
</div>
<div id="lstnumberx67" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">18</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx68" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">19</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">};</span>
</div>
</div>
</div>
<div id="S4.SS1.p3" class="ltx_para">
<p class="ltx_p">The encoding is simply the concatenation of element encodings. For example, a pair of Elias Gamma encoded integers <math id="S4.SS1.p3.m1" class="ltx_Math" alttext="(5,3)" display="inline"><mrow><mo stretchy="false">(</mo><mn>5</mn><mo>,</mo><mn>3</mn><mo stretchy="false">)</mo></mrow></math> requires only <math id="S4.SS1.p3.m2" class="ltx_Math" alttext="3+2=5" display="inline"><mrow><mrow><mn>3</mn><mo>+</mo><mn>2</mn></mrow><mo>=</mo><mn>5</mn></mrow></math> bits, not aligned to byte boundaries.</p>
</div>
</section>
<section id="S4.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.2 </span>Sum Types</h3>

<div id="S4.SS2.p1" class="ltx_para">
<p class="ltx_p">Sum types (discriminated unions) encode a choice among alternatives. The <span class="ltx_text ltx_font_typewriter">PackedVariant</span> uses minimal bits for the discriminator:</p>
</div>
<div id="S4.SS2.p2" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,dGVtcGxhdGU8UGFja2VkVmFsdWUuLi4gVHlwZXM+CmNsYXNzIFBhY2tlZFZhcmlhbnQgewogICAgc3RkOjp2YXJpYW50PFR5cGVzLi4uPiBkYXRhXzsKCiAgICBzdGF0aWMgY29uc3RleHByIHNpemVfdCBpbmRleF9iaXRzKCkgewogICAgICAgIGNvbnN0ZXhwciBzaXplX3QgbiA9IHNpemVvZi4uLihUeXBlcyk7CiAgICAgICAgaWYgKG4gPD0gMikgcmV0dXJuIDE7CiAgICAgICAgaWYgKG4gPD0gNCkgcmV0dXJuIDI7CiAgICAgICAgLy8gLi4uIHVwIHRvIGNlaWwobG9nMihuKSkgYml0cwogICAgfQoKICAgIHRlbXBsYXRlPHR5cGVuYW1lIFNpbms+CiAgICBzdGF0aWMgdm9pZCBlbmNvZGUoY29uc3QgUGFja2VkVmFyaWFudCYgdiwgU2luayYgc2luaykgewogICAgICAgIC8vIEVuY29kZSBpbmRleCB1c2luZyBtaW5pbWFsIGJpdHMKICAgICAgICBzaXplX3QgaWR4ID0gdi5kYXRhXy5pbmRleCgpOwogICAgICAgIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwgaW5kZXhfYml0cygpOyArK2kpCiAgICAgICAgICAgIHNpbmsud3JpdGUoKGlkeCA+PiBpKSAmIDEpOwogICAgICAgIC8vIEVuY29kZSB0aGUgYWN0aXZlIGFsdGVybmF0aXZlCiAgICAgICAgc3RkOjp2aXNpdChbJl0oY29uc3QgYXV0byYgdmFsKSB7CiAgICAgICAgICAgIHVzaW5nIFQgPSBzdGQ6OmRlY2F5X3Q8ZGVjbHR5cGUodmFsKT47CiAgICAgICAgICAgIFQ6OmVuY29kZSh2YWwsIHNpbmspOwogICAgICAgIH0sIHYuZGF0YV8pOwogICAgfQp9Ow==" download="">⬇</a></div>
<div id="lstnumberx69" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedValue</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">...</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Types</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx70" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">class</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedVariant</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx71" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">variant</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Types</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">...&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">data_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx72" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span>
</div>
<div id="lstnumberx73" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">static</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">constexpr</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">size_t</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">index_bits</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">()</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx74" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">constexpr</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">size_t</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">n</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">sizeof</span></span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">...(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Types</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx75" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">if</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">n</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">2)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">return</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">1;</span>
</div>
<div id="lstnumberx76" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">if</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">n</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">4)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">return</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">2;</span>
</div>
<div id="lstnumberx77" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">9</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>...<span class="ltx_text ltx_lst_space"> </span>up<span class="ltx_text ltx_lst_space"> </span>to<span class="ltx_text ltx_lst_space"> </span>ceil(log2(n))<span class="ltx_text ltx_lst_space"> </span>bits</span>
</div>
<div id="lstnumberx78" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">10</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx79" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">11</span>
</div>
<div id="lstnumberx80" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">12</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx81" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">13</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">static</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">void</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">const</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedVariant</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">v</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx82" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">14</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Encode<span class="ltx_text ltx_lst_space"> </span>index<span class="ltx_text ltx_lst_space"> </span>using<span class="ltx_text ltx_lst_space"> </span>minimal<span class="ltx_text ltx_lst_space"> </span>bits</span>
</div>
<div id="lstnumberx83" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">15</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">size_t</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">idx</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">v</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">data_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">index</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">();</span>
</div>
<div id="lstnumberx84" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">16</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">for</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">size_t</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">i</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">0;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">i</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">index_bits</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">();</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">++</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">i</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span>
</div>
<div id="lstnumberx85" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">17</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">            </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">write</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">((</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">idx</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">i</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">1);</span>
</div>
<div id="lstnumberx86" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">18</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Encode<span class="ltx_text ltx_lst_space"> </span>the<span class="ltx_text ltx_lst_space"> </span>active<span class="ltx_text ltx_lst_space"> </span>alternative</span>
</div>
<div id="lstnumberx87" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">19</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">visit</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">([&amp;](</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">const</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">auto</span></span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">val</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx88" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">20</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">            </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">using</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">decay_t</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">decltype</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">val</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)&gt;;</span>
</div>
<div id="lstnumberx89" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">21</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">            </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">val</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx90" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">22</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">},</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">v</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">data_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx91" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">23</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx92" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">24</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">};</span>
</div>
</div>
</div>
<div id="S4.SS2.p3" class="ltx_para">
<p class="ltx_p">For <math id="S4.SS2.p3.m1" class="ltx_Math" alttext="n" display="inline"><mi>n</mi></math> alternatives, the discriminator requires <math id="S4.SS2.p3.m2" class="ltx_Math" alttext="\lceil\log_{2}n\rceil" display="inline"><mrow><mo stretchy="false">⌈</mo><mrow><msub><mi>log</mi><mn>2</mn></msub><mo lspace="0.167em">⁡</mo><mi>n</mi></mrow><mo stretchy="false">⌉</mo></mrow></math> bits. A variant of four packed integers uses only 2 bits for discrimination plus the value encoding.</p>
</div>
</section>
<section id="S4.SS3" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.3 </span>Optional Values</h3>

<div id="S4.SS3.p1" class="ltx_para">
<p class="ltx_p">Optional types (Maybe/Option) are special cases of sum types:</p>
</div>
<div id="S4.SS3.p2" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,dGVtcGxhdGU8UGFja2VkVmFsdWUgVD4KdXNpbmcgUGFja2VkTWF5YmUgPSBQYWNrZWRWYXJpYW50PFVuaXQsIFQ+OwoKdGVtcGxhdGU8UGFja2VkVmFsdWUgVD4KY2xhc3MgUGFja2VkT3B0aW9uYWwgewogICAgc3RkOjpvcHRpb25hbDxUPiBvcHRfOwpwdWJsaWM6CiAgICB0ZW1wbGF0ZTx0eXBlbmFtZSBTaW5rPgogICAgc3RhdGljIHZvaWQgZW5jb2RlKGNvbnN0IFBhY2tlZE9wdGlvbmFsJiBwLCBTaW5rJiBzaW5rKSB7CiAgICAgICAgY29kZWNzOjpCb29sZWFuOjplbmNvZGUocC5oYXNfdmFsdWUoKSwgc2luayk7CiAgICAgICAgaWYgKHAuaGFzX3ZhbHVlKCkpCiAgICAgICAgICAgIFQ6OmVuY29kZSgqcC5vcHRfLCBzaW5rKTsKICAgIH0KfTs=" download="">⬇</a></div>
<div id="lstnumberx93" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedValue</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx94" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">using</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedMaybe</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedVariant</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Unit</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;;</span>
</div>
<div id="lstnumberx95" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span>
</div>
<div id="lstnumberx96" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedValue</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx97" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">class</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedOptional</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx98" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">optional</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">opt_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx99" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">public</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">:</span>
</div>
<div id="lstnumberx100" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx101" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">9</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">static</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">void</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">const</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedOptional</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">p</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx102" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">10</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">codecs</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Boolean</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">p</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">has_value</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(),</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx103" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">11</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">if</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">p</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">has_value</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">())</span>
</div>
<div id="lstnumberx104" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">12</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">            </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(*</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">p</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">opt_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx105" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">13</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx106" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">14</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">};</span>
</div>
</div>
</div>
<div id="S4.SS3.p3" class="ltx_para">
<p class="ltx_p">The encoding uses a single bit for the presence flag. The <span class="ltx_text ltx_font_typewriter">Unit</span> type encodes nothing, serving as the identity element for products.</p>
</div>
</section>
<section id="S4.SS4" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.4 </span>Recursive Types</h3>

<div id="S4.SS4.p1" class="ltx_para">
<p class="ltx_p">The prefix-free property enables recursive type definitions. A linked list:</p>
</div>
<div id="S4.SS4.p2" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,dGVtcGxhdGU8UGFja2VkVmFsdWUgRWxlbWVudD4KY2xhc3MgUGFja2VkTGlzdCB7CiAgICBQYWNrZWRMaXN0Tm9kZTxFbGVtZW50PiBub2RlXzsKfTsKCnRlbXBsYXRlPFBhY2tlZFZhbHVlIEVsZW1lbnQ+CnVzaW5nIFBhY2tlZExpc3ROb2RlID0gUGFja2VkVmFyaWFudDwKICAgIFVuaXQsICAvLyBOaWwKICAgIFBhY2tlZFBhaXI8RWxlbWVudCwKICAgICAgICAgICAgICAgUGFja2VkU2hhcmVkUHRyPFBhY2tlZExpc3Q8RWxlbWVudD4+PiAvLyBDb25zCj47" download="">⬇</a></div>
<div id="lstnumberx107" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedValue</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Element</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx108" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">class</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedList</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx109" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedListNode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Element</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">node_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx110" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">};</span>
</div>
<div id="lstnumberx111" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span>
</div>
<div id="lstnumberx112" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedValue</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Element</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx113" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">using</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedListNode</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedVariant</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span>
</div>
<div id="lstnumberx114" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Unit</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">  </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Nil</span>
</div>
<div id="lstnumberx115" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">9</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedPair</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Element</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span>
</div>
<div id="lstnumberx116" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">10</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">               </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedSharedPtr</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedList</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Element</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;&gt;&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Cons</span>
</div>
<div id="lstnumberx117" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">11</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;;</span>
</div>
</div>
</div>
<div id="S4.SS4.p3" class="ltx_para">
<p class="ltx_p">Each cons cell encodes as a discriminator (1 bit), the element, and recursively the tail. The nil case uses just the discriminator. This achieves near-optimal encoding for lists: 1 bit overhead per element.</p>
</div>
<div id="S4.SS4.p4" class="ltx_para">
<p class="ltx_p">Similarly, binary trees:</p>
</div>
<div id="S4.SS4.p5" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,dGVtcGxhdGU8UGFja2VkVmFsdWUgVmFsdWU+CnVzaW5nIFBhY2tlZFRyZWVOb2RlID0gUGFja2VkVmFyaWFudDwKICAgIFVuaXQsICAvLyBMZWFmCiAgICBQYWNrZWRUdXBsZTxWYWx1ZSwKICAgICAgICAgICAgICAgIFBhY2tlZFNoYXJlZFB0cjxQYWNrZWRUcmVlPFZhbHVlPj4sCiAgICAgICAgICAgICAgICBQYWNrZWRTaGFyZWRQdHI8UGFja2VkVHJlZTxWYWx1ZT4+PiAvLyBCcmFuY2gKPjs=" download="">⬇</a></div>
<div id="lstnumberx118" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedValue</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Value</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx119" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">using</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedTreeNode</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedVariant</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span>
</div>
<div id="lstnumberx120" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Unit</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">  </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Leaf</span>
</div>
<div id="lstnumberx121" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedTuple</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Value</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span>
</div>
<div id="lstnumberx122" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">                </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedSharedPtr</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedTree</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Value</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;&gt;,</span>
</div>
<div id="lstnumberx123" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">                </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedSharedPtr</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedTree</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Value</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;&gt;&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Branch</span>
</div>
<div id="lstnumberx124" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;;</span>
</div>
</div>
</div>
<div id="S4.SS4.p6" class="ltx_para">
<p class="ltx_p">The shared pointer codec encodes a boolean flag for null, then recursively the pointed-to value. This prevents infinite recursion during encoding while maintaining structural sharing in memory.</p>
</div>
</section>
</section>
<section id="S5" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5 </span>Zero-Copy Iteration and STL Integration</h2>

<div id="S5.p1" class="ltx_para">
<p class="ltx_p">A fundamental challenge is providing random access to variable-length encoded elements while maintaining the zero-copy invariant. The solution uses offset vectors and proxy values.</p>
</div>
<section id="S5.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.1 </span>Packed Containers</h3>

<div id="S5.SS1.p1" class="ltx_para">
<p class="ltx_p">The <span class="ltx_text ltx_font_typewriter">PackedContainer</span> stores elements sequentially and maintains byte offsets:</p>
</div>
<div id="S5.SS1.p2" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,dGVtcGxhdGU8UGFja2VkVmFsdWUgRWxlbWVudD4KY2xhc3MgUGFja2VkQ29udGFpbmVyIHsKICAgIHN0ZDo6dmVjdG9yPHVpbnQ4X3Q+IGRhdGFfOyAgICAgICAvLyBCaXQtcGFja2VkIGVsZW1lbnRzCiAgICBzdGQ6OnZlY3RvcjxzaXplX3Q+IG9mZnNldHNfOyAgICAgLy8gQnl0ZSBvZmZzZXRzIHRvIGVhY2ggZWxlbWVudAogICAgc2l6ZV90IGNvdW50XyA9IDA7CgpwdWJsaWM6CiAgICB2YWx1ZV90eXBlIG9wZXJhdG9yW10oc2l6ZV90IHBvcykgY29uc3QgewogICAgICAgIEJpdFJlYWRlciByZWFkZXIoCiAgICAgICAgICAgIGRhdGFfLmRhdGEoKSArIG9mZnNldHNfW3Bvc10sCiAgICAgICAgICAgIG9mZnNldHNfW3BvcyArIDFdIC0gb2Zmc2V0c19bcG9zXQogICAgICAgICk7CiAgICAgICAgcmV0dXJuIEVsZW1lbnQ6OmRlY29kZShyZWFkZXIpLnZhbHVlKCk7CiAgICB9Cn07" download="">⬇</a></div>
<div id="lstnumberx125" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedValue</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Element</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx126" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">class</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedContainer</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx127" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">vector</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">uint8_t</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">data_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">       </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Bit-packed<span class="ltx_text ltx_lst_space"> </span>elements</span>
</div>
<div id="lstnumberx128" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">vector</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">size_t</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">offsets_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">     </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Byte<span class="ltx_text ltx_lst_space"> </span>offsets<span class="ltx_text ltx_lst_space"> </span>to<span class="ltx_text ltx_lst_space"> </span>each<span class="ltx_text ltx_lst_space"> </span>element</span>
</div>
<div id="lstnumberx129" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">size_t</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">count_</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">0;</span>
</div>
<div id="lstnumberx130" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span>
</div>
<div id="lstnumberx131" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">public</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">:</span>
</div>
<div id="lstnumberx132" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value_type</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">operator</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">[](</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">size_t</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">pos</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">const</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx133" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">9</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">BitReader</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">reader</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span>
</div>
<div id="lstnumberx134" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">10</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">            </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">data_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">data</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">()</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">+</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">offsets_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">[</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">pos</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">],</span>
</div>
<div id="lstnumberx135" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">11</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">            </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">offsets_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">[</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">pos</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">+</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">1]</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">-</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">offsets_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">[</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">pos</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">]</span>
</div>
<div id="lstnumberx136" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">12</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx137" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">13</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">return</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Element</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">decode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">reader</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">).</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">();</span>
</div>
<div id="lstnumberx138" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">14</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx139" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">15</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">};</span>
</div>
</div>
</div>
<div id="S5.SS1.p3" class="ltx_para">
<p class="ltx_p">The offset vector enables <math id="S5.SS1.p3.m1" class="ltx_Math" alttext="O(1)" display="inline"><mrow><mi>O</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mrow></math> random access. For <math id="S5.SS1.p3.m2" class="ltx_Math" alttext="n" display="inline"><mi>n</mi></math> elements, we store <math id="S5.SS1.p3.m3" class="ltx_Math" alttext="n+1" display="inline"><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></math> offsets (the final offset marks the end). Memory overhead is <math id="S5.SS1.p3.m4" class="ltx_Math" alttext="n\times sizeof(size\_t)" display="inline"><mrow><mrow><mi>n</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>s</mi></mrow><mo>⁢</mo><mi>i</mi><mo>⁢</mo><mi>z</mi><mo>⁢</mo><mi>e</mi><mo>⁢</mo><mi>o</mi><mo>⁢</mo><mi>f</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mrow><mi>s</mi><mo>⁢</mo><mi>i</mi><mo>⁢</mo><mi>z</mi><mo>⁢</mo><mi>e</mi><mo>⁢</mo><mi mathvariant="normal">_</mi><mo>⁢</mo><mi>t</mi></mrow><mo stretchy="false">)</mo></mrow></mrow></math> bytes, independent of element size.</p>
</div>
</section>
<section id="S5.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.2 </span>Proxy Values</h3>

<div id="S5.SS2.p1" class="ltx_para">
<p class="ltx_p">Direct element access would violate the zero-copy invariant by creating unpacked copies. Instead, we use proxy objects that decode on access:</p>
</div>
<div id="S5.SS2.p2" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,dGVtcGxhdGU8dHlwZW5hbWUgRWxlbWVudCwgdHlwZW5hbWUgQ29udGFpbmVyPgpjbGFzcyBQYWNrZWRQcm94eSB7CiAgICBDb250YWluZXIqIGNvbnRhaW5lcl87CiAgICBzaXplX3QgaW5kZXhfOwogICAgbXV0YWJsZSBzdGQ6Om9wdGlvbmFsPEVsZW1lbnQ+IGNhY2hlZF87CgpwdWJsaWM6CiAgICBvcGVyYXRvciB2YWx1ZV90eXBlKCkgY29uc3QgewogICAgICAgIGlmICghY2FjaGVkXykgewogICAgICAgICAgICBCaXRSZWFkZXIgcmVhZGVyKGNvbnRhaW5lcl8tPnJhd19kYXRhKGluZGV4XykpOwogICAgICAgICAgICBjYWNoZWRfID0gRWxlbWVudDo6ZGVjb2RlKHJlYWRlcik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjYWNoZWRfLT52YWx1ZSgpOwogICAgfQoKICAgIFBhY2tlZFByb3h5JiBvcGVyYXRvcj0oY29uc3QgdmFsdWVfdHlwZSYgdmFsKSB7CiAgICAgICAgY2FjaGVkXyA9IEVsZW1lbnR7dmFsfTsKICAgICAgICBjb250YWluZXJfLT51cGRhdGVfZWxlbWVudChpbmRleF8sICpjYWNoZWRfKTsKICAgICAgICByZXR1cm4gKnRoaXM7CiAgICB9Cn07" download="">⬇</a></div>
<div id="lstnumberx140" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Element</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Container</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx141" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">class</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedProxy</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx142" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Container</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">*</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">container_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx143" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">size_t</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">index_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx144" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">mutable</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">optional</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Element</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">cached_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx145" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span>
</div>
<div id="lstnumberx146" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">public</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">:</span>
</div>
<div id="lstnumberx147" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">operator</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value_type</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">()</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">const</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx148" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">9</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">if</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(!</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">cached_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx149" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">10</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">            </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">BitReader</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">reader</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">container_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">-&gt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">raw_data</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">index_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">));</span>
</div>
<div id="lstnumberx150" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">11</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">            </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">cached_</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Element</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">decode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">reader</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx151" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">12</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx152" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">13</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">return</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">cached_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">-&gt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">();</span>
</div>
<div id="lstnumberx153" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">14</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx154" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">15</span>
</div>
<div id="lstnumberx155" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">16</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedProxy</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">operator</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=(</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">const</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value_type</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">val</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx156" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">17</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">cached_</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Element</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">val</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">};</span>
</div>
<div id="lstnumberx157" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">18</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">container_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">-&gt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">update_element</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">index_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">*</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">cached_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx158" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">19</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">return</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">*</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">this</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx159" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">20</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx160" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">21</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">};</span>
</div>
</div>
</div>
<div id="S5.SS2.p3" class="ltx_para">
<p class="ltx_p">The proxy provides value semantics while deferring actual decoding until needed. Comparison operators convert through the value type, enabling natural usage:</p>
</div>
<div id="S5.SS2.p4" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,UGFja2VkQ29udGFpbmVyPFBhY2tlZFUzMjw+PiB2ZWM7CnZlYy5wdXNoX2JhY2soUGFja2VkVTMyPD57NDJ9KTsKaWYgKHZlY1swXSA9PSA0MikgeyAvKiAuLi4gKi8gfSAgLy8gVHJhbnNwYXJlbnQgYWNjZXNz" download="">⬇</a></div>
<div id="lstnumberx161" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedContainer</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedU32</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;&gt;&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">vec</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx162" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">vec</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">push_back</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedU32</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;&gt;{42});</span>
</div>
<div id="lstnumberx163" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">if</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">vec</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">[0]</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">==</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">42)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">/*<span class="ltx_text ltx_lst_space"> </span>...<span class="ltx_text ltx_lst_space"> </span>*/</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">  </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Transparent<span class="ltx_text ltx_lst_space"> </span>access</span>
</div>
</div>
</div>
</section>
<section id="S5.SS3" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.3 </span>Iterator Design</h3>

<div id="S5.SS3.p1" class="ltx_para">
<p class="ltx_p">STL algorithms require iterators satisfying specific concepts. The <span class="ltx_text ltx_font_typewriter">PackedIterator</span> provides random access semantics:</p>
</div>
<div id="S5.SS3.p2" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,dGVtcGxhdGU8dHlwZW5hbWUgRWxlbWVudCwgdHlwZW5hbWUgQ29udGFpbmVyPgpjbGFzcyBQYWNrZWRJdGVyYXRvciB7CnB1YmxpYzoKICAgIHVzaW5nIGl0ZXJhdG9yX2NhdGVnb3J5ID0gc3RkOjpyYW5kb21fYWNjZXNzX2l0ZXJhdG9yX3RhZzsKICAgIHVzaW5nIHZhbHVlX3R5cGUgPSB0eXBlbmFtZSBFbGVtZW50Ojp2YWx1ZV90eXBlOwogICAgdXNpbmcgcmVmZXJlbmNlID0gUGFja2VkUHJveHk8RWxlbWVudCwgQ29udGFpbmVyPjsKCiAgICByZWZlcmVuY2Ugb3BlcmF0b3IqKCkgY29uc3QgewogICAgICAgIHJldHVybiByZWZlcmVuY2UoY29udGFpbmVyXywgaW5kZXhfKTsKICAgIH0KCiAgICByZWZlcmVuY2Ugb3BlcmF0b3JbXShkaWZmZXJlbmNlX3R5cGUgbikgY29uc3QgewogICAgICAgIHJldHVybiByZWZlcmVuY2UoY29udGFpbmVyXywgaW5kZXhfICsgbik7CiAgICB9CgogICAgLy8gQXJpdGhtZXRpYyBhbmQgY29tcGFyaXNvbiBvcGVyYXRvcnMuLi4KfTs=" download="">⬇</a></div>
<div id="lstnumberx164" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Element</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Container</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx165" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">class</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedIterator</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx166" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">public</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">:</span>
</div>
<div id="lstnumberx167" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">using</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">iterator_category</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">random_access_iterator_tag</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx168" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">using</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value_type</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Element</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value_type</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx169" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">using</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">reference</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedProxy</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Element</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Container</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;;</span>
</div>
<div id="lstnumberx170" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span>
</div>
<div id="lstnumberx171" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">reference</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">operator</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">*()</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">const</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx172" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">9</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">return</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">reference</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">container_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">index_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx173" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">10</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx174" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">11</span>
</div>
<div id="lstnumberx175" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">12</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">reference</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">operator</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">[](</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">difference_type</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">n</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">const</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx176" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">13</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">return</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">reference</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">container_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">index_</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">+</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">n</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx177" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">14</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx178" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">15</span>
</div>
<div id="lstnumberx179" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">16</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Arithmetic<span class="ltx_text ltx_lst_space"> </span>and<span class="ltx_text ltx_lst_space"> </span>comparison<span class="ltx_text ltx_lst_space"> </span>operators...</span>
</div>
<div id="lstnumberx180" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">17</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">};</span>
</div>
</div>
</div>
<div id="S5.SS3.p3" class="ltx_para">
<p class="ltx_p">This design enables standard algorithms:</p>
</div>
<div id="S5.SS3.p4" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,UGFja2VkQ29udGFpbmVyPFBhY2tlZFUzMjxFbGlhc0dhbW1hPj4gZGF0YTsKLy8gRmlsbCB3aXRoIGRhdGEuLi4KCi8vIFN0YW5kYXJkIGFsZ29yaXRobXMgd29yayB0cmFuc3BhcmVudGx5CmF1dG8gaXQgPSBzdGQ6OmZpbmQoZGF0YS5iZWdpbigpLCBkYXRhLmVuZCgpLCA0Mik7CmludCBzdW0gPSBzdGQ6OmFjY3VtdWxhdGUoZGF0YS5iZWdpbigpLCBkYXRhLmVuZCgpLCAwKTs=" download="">⬇</a></div>
<div id="lstnumberx181" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedContainer</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedU32</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">EliasGamma</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">data</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx182" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Fill<span class="ltx_text ltx_lst_space"> </span>with<span class="ltx_text ltx_lst_space"> </span>data...</span>
</div>
<div id="lstnumberx183" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span>
</div>
<div id="lstnumberx184" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Standard<span class="ltx_text ltx_lst_space"> </span>algorithms<span class="ltx_text ltx_lst_space"> </span>work<span class="ltx_text ltx_lst_space"> </span>transparently</span>
</div>
<div id="lstnumberx185" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">auto</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">it</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">find</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">data</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">begin</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(),</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">data</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">end</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(),</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">42);</span>
</div>
<div id="lstnumberx186" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">int</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sum</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">accumulate</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">data</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">begin</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(),</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">data</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">end</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(),</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">0);</span>
</div>
</div>
</div>
<div id="S5.SS3.p5" class="ltx_para">
<p class="ltx_p">The compiler optimizes through the proxy layer, producing code nearly as efficient as hand-written decoding loops.</p>
</div>
</section>
</section>
<section id="S6" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6 </span>Numeric Codecs</h2>

<div id="S6.p1" class="ltx_para">
<p class="ltx_p">Beyond integers, the library provides sophisticated encodings for floating-point and rational numbers.</p>
</div>
<section id="S6.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">6.1 </span>Configurable Floating Point</h3>

<div id="S6.SS1.p1" class="ltx_para">
<p class="ltx_p">The <span class="ltx_text ltx_font_typewriter">FloatingPoint&lt;MantissaBits, ExponentBits&gt;</span> codec enables precision-space tradeoffs:</p>
</div>
<div id="S6.SS1.p2" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,dGVtcGxhdGU8c2l6ZV90IE1hbnRpc3NhQml0cyA9IDIzLCBzaXplX3QgRXhwb25lbnRCaXRzID0gOD4Kc3RydWN0IEZsb2F0aW5nUG9pbnQgewogICAgc3RhdGljIHZvaWQgZW5jb2RlKGRvdWJsZSB2YWx1ZSwgYXV0byYgc2luaykgewogICAgICAgIGlmIChzdGQ6OmlzbmFuKHZhbHVlKSB8fCBzdGQ6OmlzaW5mKHZhbHVlKSkgewogICAgICAgICAgICAvLyBTcGVjaWFsIHZhbHVlIGVuY29kaW5nCiAgICAgICAgfQogICAgICAgIGludCBleHBvbmVudDsKICAgICAgICBkb3VibGUgbWFudGlzc2EgPSBzdGQ6OmZyZXhwKHZhbHVlLCAmZXhwb25lbnQpOwoKICAgICAgICAvLyBTaWduIGJpdAogICAgICAgIGNvZGVjczo6Qm9vbGVhbjo6ZW5jb2RlKG1hbnRpc3NhIDwgMCwgc2luayk7CgogICAgICAgIC8vIEJpYXNlZCBleHBvbmVudAogICAgICAgIGludDMyX3QgYmlhcyA9ICgxIDw8IChFeHBvbmVudEJpdHMgLSAxKSkgLSAxOwogICAgICAgIGludDMyX3QgYmlhc2VkID0gZXhwb25lbnQgKyBiaWFzOwogICAgICAgIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwgRXhwb25lbnRCaXRzOyArK2kpCiAgICAgICAgICAgIHNpbmsud3JpdGUoKGJpYXNlZCA+PiBpKSAmIDEpOwoKICAgICAgICAvLyBNYW50aXNzYSBiaXRzIChza2lwIGltcGxpY2l0IGxlYWRpbmcgMSkKICAgICAgICBtYW50aXNzYSA9IHN0ZDo6YWJzKG1hbnRpc3NhKSAtIDAuNTsKICAgICAgICBmb3IgKHNpemVfdCBpID0gMDsgaSA8IE1hbnRpc3NhQml0czsgKytpKSB7CiAgICAgICAgICAgIG1hbnRpc3NhICo9IDI7CiAgICAgICAgICAgIHNpbmsud3JpdGUobWFudGlzc2EgPj0gMS4wKTsKICAgICAgICAgICAgaWYgKG1hbnRpc3NhID49IDEuMCkgbWFudGlzc2EgLT0gMS4wOwogICAgICAgIH0KICAgIH0KfTsKCi8vIENvbW1vbiBmb3JtYXRzCnVzaW5nIEZsb2F0MTYgPSBGbG9hdGluZ1BvaW50PDEwLCA1PjsgICAvLyAxNiBiaXRzIHRvdGFsCnVzaW5nIEZsb2F0MzIgPSBGbG9hdGluZ1BvaW50PDIzLCA4PjsgICAvLyAzMiBiaXRzIHRvdGFsCnVzaW5nIEJGbG9hdDE2ID0gRmxvYXRpbmdQb2ludDw3LCA4PjsgICAvLyBHb29nbGUncyBiZmxvYXQxNg==" download="">⬇</a></div>
<div id="lstnumberx187" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">size_t</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">MantissaBits</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">23,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">size_t</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">ExponentBits</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">8&gt;</span>
</div>
<div id="lstnumberx188" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">struct</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">FloatingPoint</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx189" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">static</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">void</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">double</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">auto</span></span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx190" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">if</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">isnan</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">||</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">isinf</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">))</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx191" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">            </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Special<span class="ltx_text ltx_lst_space"> </span>value<span class="ltx_text ltx_lst_space"> </span>encoding</span>
</div>
<div id="lstnumberx192" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx193" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">int</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">exponent</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx194" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">double</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">mantissa</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">frexp</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">exponent</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx195" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">9</span>
</div>
<div id="lstnumberx196" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">10</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Sign<span class="ltx_text ltx_lst_space"> </span>bit</span>
</div>
<div id="lstnumberx197" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">11</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">codecs</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Boolean</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">mantissa</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">0,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx198" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">12</span>
</div>
<div id="lstnumberx199" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">13</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Biased<span class="ltx_text ltx_lst_space"> </span>exponent</span>
</div>
<div id="lstnumberx200" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">14</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">int32_t</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">bias</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(1</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;&lt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">ExponentBits</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">-</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">1))</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">-</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">1;</span>
</div>
<div id="lstnumberx201" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">15</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">int32_t</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">biased</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">exponent</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">+</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">bias</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx202" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">16</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">for</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">size_t</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">i</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">0;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">i</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">ExponentBits</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">++</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">i</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span>
</div>
<div id="lstnumberx203" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">17</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">            </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">write</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">((</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">biased</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">i</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">1);</span>
</div>
<div id="lstnumberx204" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">18</span>
</div>
<div id="lstnumberx205" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">19</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Mantissa<span class="ltx_text ltx_lst_space"> </span>bits<span class="ltx_text ltx_lst_space"> </span>(skip<span class="ltx_text ltx_lst_space"> </span>implicit<span class="ltx_text ltx_lst_space"> </span>leading<span class="ltx_text ltx_lst_space"> </span>1)</span>
</div>
<div id="lstnumberx206" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">20</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">mantissa</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">abs</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">mantissa</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">-</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">0.5;</span>
</div>
<div id="lstnumberx207" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">21</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">for</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">size_t</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">i</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">0;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">i</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">MantissaBits</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">++</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">i</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx208" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">22</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">            </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">mantissa</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">*=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">2;</span>
</div>
<div id="lstnumberx209" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">23</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">            </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">write</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">mantissa</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">1.0);</span>
</div>
<div id="lstnumberx210" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">24</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">            </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">if</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">mantissa</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">1.0)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">mantissa</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">-=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">1.0;</span>
</div>
<div id="lstnumberx211" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">25</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx212" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">26</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx213" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">27</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">};</span>
</div>
<div id="lstnumberx214" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">28</span>
</div>
<div id="lstnumberx215" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">29</span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Common<span class="ltx_text ltx_lst_space"> </span>formats</span>
</div>
<div id="lstnumberx216" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">30</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">using</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Float16</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">FloatingPoint</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;10,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">5&gt;;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">   </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>16<span class="ltx_text ltx_lst_space"> </span>bits<span class="ltx_text ltx_lst_space"> </span>total</span>
</div>
<div id="lstnumberx217" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">31</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">using</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Float32</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">FloatingPoint</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;23,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">8&gt;;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">   </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>32<span class="ltx_text ltx_lst_space"> </span>bits<span class="ltx_text ltx_lst_space"> </span>total</span>
</div>
<div id="lstnumberx218" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">32</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">using</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">BFloat16</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">FloatingPoint</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;7,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">8&gt;;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">   </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Google’s<span class="ltx_text ltx_lst_space"> </span>bfloat16</span>
</div>
</div>
</div>
<div id="S6.SS1.p3" class="ltx_para">
<p class="ltx_p">This approach supports half-precision (16-bit), single-precision (32-bit), and custom formats. For machine learning applications, BFloat16 (7 mantissa bits, 8 exponent bits) provides a favorable accuracy-size tradeoff.</p>
</div>
</section>
<section id="S6.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">6.2 </span>Rational Numbers</h3>

<div id="S6.SS2.p1" class="ltx_para">
<p class="ltx_p">Exact rational arithmetic uses continued fraction approximation:</p>
</div>
<div id="S6.SS2.p2" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,dGVtcGxhdGU8dHlwZW5hbWUgSW50Q29kZWMgPSBFbGlhc0dhbW1hPgpzdHJ1Y3QgUmF0aW9uYWwgewogICAgc3RhdGljIHZvaWQgZW5jb2RlKGRvdWJsZSB2YWx1ZSwgYXV0byYgc2luaykgewogICAgICAgIC8vIENvbnRpbnVlZCBmcmFjdGlvbiBhcHByb3hpbWF0aW9uCiAgICAgICAgc3RkOjp2ZWN0b3I8aW50PiBjZiA9IGNvbnRpbnVlZF9mcmFjdGlvbih2YWx1ZSk7CgogICAgICAgIC8vIEVuY29kZSBsZW5ndGgsIHRoZW4gY29lZmZpY2llbnRzCiAgICAgICAgSW50Q29kZWM6OmVuY29kZShjZi5zaXplKCksIHNpbmspOwogICAgICAgIGZvciAoaW50IGNvZWZmIDogY2YpCiAgICAgICAgICAgIEludENvZGVjOjplbmNvZGUoY29lZmYsIHNpbmspOwogICAgfQp9Ow==" download="">⬇</a></div>
<div id="lstnumberx219" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">IntCodec</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">EliasGamma</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx220" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">struct</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Rational</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx221" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">static</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">void</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">double</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">auto</span></span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx222" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Continued<span class="ltx_text ltx_lst_space"> </span>fraction<span class="ltx_text ltx_lst_space"> </span>approximation</span>
</div>
<div id="lstnumberx223" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">vector</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">int</span></span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">cf</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">continued_fraction</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx224" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span>
</div>
<div id="lstnumberx225" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Encode<span class="ltx_text ltx_lst_space"> </span>length,<span class="ltx_text ltx_lst_space"> </span>then<span class="ltx_text ltx_lst_space"> </span>coefficients</span>
</div>
<div id="lstnumberx226" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">IntCodec</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">cf</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">size</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(),</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx227" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">9</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">for</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">int</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">coeff</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">:</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">cf</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span>
</div>
<div id="lstnumberx228" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">10</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">            </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">IntCodec</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">coeff</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx229" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">11</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx230" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">12</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">};</span>
</div>
</div>
</div>
<div id="S6.SS2.p3" class="ltx_para">
<p class="ltx_p">For ratios with small numerators and denominators, this achieves excellent compression. The fraction <math id="S6.SS2.p3.m1" class="ltx_Math" alttext="22/7" display="inline"><mrow><mn>22</mn><mo>/</mo><mn>7</mn></mrow></math> (pi approximation) encodes in fewer bits than a 32-bit float.</p>
</div>
</section>
<section id="S6.SS3" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">6.3 </span>Complex Numbers</h3>

<div id="S6.SS3.p1" class="ltx_para">
<p class="ltx_p">Both rectangular and polar representations are supported:</p>
</div>
<div id="S6.SS3.p2" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,dGVtcGxhdGU8dHlwZW5hbWUgRmxvYXRDb2RlYz4Kc3RydWN0IENvbXBsZXhSZWN0IHsKICAgIHN0YXRpYyB2b2lkIGVuY29kZShzdGQ6OmNvbXBsZXg8ZG91YmxlPiB6LCBhdXRvJiBzaW5rKSB7CiAgICAgICAgRmxvYXRDb2RlYzo6ZW5jb2RlKHoucmVhbCgpLCBzaW5rKTsKICAgICAgICBGbG9hdENvZGVjOjplbmNvZGUoei5pbWFnKCksIHNpbmspOwogICAgfQp9OwoKdGVtcGxhdGU8dHlwZW5hbWUgRmxvYXRDb2RlYywgdHlwZW5hbWUgQW5nbGVDb2RlYz4Kc3RydWN0IENvbXBsZXhQb2xhciB7CiAgICBzdGF0aWMgdm9pZCBlbmNvZGUoc3RkOjpjb21wbGV4PGRvdWJsZT4geiwgYXV0byYgc2luaykgewogICAgICAgIEZsb2F0Q29kZWM6OmVuY29kZShzdGQ6OmFicyh6KSwgc2luayk7CiAgICAgICAgQW5nbGVDb2RlYzo6ZW5jb2RlKHN0ZDo6YXJnKHopLCBzaW5rKTsKICAgIH0KfTs=" download="">⬇</a></div>
<div id="lstnumberx231" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">FloatCodec</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx232" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">struct</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">ComplexRect</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx233" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">static</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">void</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">complex</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">double</span></span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">z</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">auto</span></span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx234" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">FloatCodec</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">z</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">real</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(),</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx235" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">FloatCodec</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">z</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">imag</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(),</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx236" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx237" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">};</span>
</div>
<div id="lstnumberx238" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span>
</div>
<div id="lstnumberx239" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">9</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">FloatCodec</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">AngleCodec</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx240" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">10</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">struct</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">ComplexPolar</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx241" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">11</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">static</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">void</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">complex</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">double</span></span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">z</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">auto</span></span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx242" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">12</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">FloatCodec</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">abs</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">z</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">),</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx243" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">13</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">AngleCodec</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">arg</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">z</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">),</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx244" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">14</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx245" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">15</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">};</span>
</div>
</div>
</div>
<div id="S6.SS3.p3" class="ltx_para">
<p class="ltx_p">Applications can choose the representation matching their data characteristics.</p>
</div>
</section>
</section>
<section id="S7" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">7 </span>Type Erasure for Runtime Polymorphism</h2>

<div id="S7.p1" class="ltx_para">
<p class="ltx_p">While compile-time polymorphism via templates is preferred, runtime polymorphism is sometimes necessary. The library provides type-erased containers:</p>
</div>
<div id="S7.p2" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,Y2xhc3MgVHlwZUVyYXNlZFBhY2tlZENvbnRhaW5lciB7CiAgICBzdHJ1Y3QgQ29uY2VwdCB7CiAgICAgICAgdmlydHVhbCB+Q29uY2VwdCgpID0gZGVmYXVsdDsKICAgICAgICB2aXJ0dWFsIHN0ZDo6dHlwZV9pbmRleCB0eXBlKCkgY29uc3QgPSAwOwogICAgICAgIHZpcnR1YWwgc2l6ZV90IHNpemUoKSBjb25zdCA9IDA7CiAgICAgICAgdmlydHVhbCBzdGQ6OmFueSBnZXQoc2l6ZV90IGluZGV4KSBjb25zdCA9IDA7CiAgICAgICAgdmlydHVhbCB2b2lkIHB1c2hfYW55KGNvbnN0IHN0ZDo6YW55JiB2YWx1ZSkgPSAwOwogICAgfTsKCiAgICB0ZW1wbGF0ZTxQYWNrZWRWYWx1ZSBFbGVtZW50PgogICAgc3RydWN0IE1vZGVsIDogQ29uY2VwdCB7CiAgICAgICAgUGFja2VkQ29udGFpbmVyPEVsZW1lbnQ+IGNvbnRhaW5lcjsKICAgICAgICAvLyBWaXJ0dWFsIG1ldGhvZCBpbXBsZW1lbnRhdGlvbnMuLi4KICAgIH07CgogICAgc3RkOjp1bmlxdWVfcHRyPENvbmNlcHQ+IGltcGxfOwp9Ow==" download="">⬇</a></div>
<div id="lstnumberx246" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">class</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">TypeErasedPackedContainer</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx247" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">struct</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Concept</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx248" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">virtual</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">~</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Concept</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">()</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">default</span></span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx249" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">virtual</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">type_index</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">type</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">()</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">const</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">0;</span>
</div>
<div id="lstnumberx250" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">virtual</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">size_t</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">size</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">()</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">const</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">0;</span>
</div>
<div id="lstnumberx251" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">virtual</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">any</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">get</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">size_t</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">index</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">const</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">0;</span>
</div>
<div id="lstnumberx252" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">virtual</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">void</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">push_any</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">const</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">any</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">0;</span>
</div>
<div id="lstnumberx253" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">};</span>
</div>
<div id="lstnumberx254" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">9</span>
</div>
<div id="lstnumberx255" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">10</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedValue</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Element</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx256" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">11</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">struct</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Model</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">:</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Concept</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx257" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">12</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedContainer</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Element</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">container</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx258" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">13</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Virtual<span class="ltx_text ltx_lst_space"> </span>method<span class="ltx_text ltx_lst_space"> </span>implementations...</span>
</div>
<div id="lstnumberx259" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">14</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">};</span>
</div>
<div id="lstnumberx260" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">15</span>
</div>
<div id="lstnumberx261" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">16</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">unique_ptr</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Concept</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">impl_</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx262" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">17</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">};</span>
</div>
</div>
</div>
<div id="S7.p3" class="ltx_para">
<p class="ltx_p">This follows the external polymorphism pattern <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib8" title="" class="ltx_ref">8</a>]</cite>. Usage:</p>
</div>
<div id="S7.p4" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,YXV0byBjb250YWluZXIgPSBUeXBlRXJhc2VkUGFja2VkQ29udGFpbmVyOjpjcmVhdGU8CiAgICBQYWNrZWRVMzI8RWxpYXNHYW1tYT4+KCk7Cgpjb250YWluZXIucHVzaF9iYWNrKDQyKTsKY29udGFpbmVyLnB1c2hfYmFjaygxNyk7CgppZiAoYXV0byB2YWwgPSBjb250YWluZXIuZ2V0PHVpbnQzMl90PigwKSkKICAgIHN0ZDo6Y291dCA8PCAqdmFsIDw8ICdcbic7" download="">⬇</a></div>
<div id="lstnumberx263" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">auto</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">container</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">TypeErasedPackedContainer</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">create</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span>
</div>
<div id="lstnumberx264" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedU32</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">EliasGamma</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;&gt;();</span>
</div>
<div id="lstnumberx265" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span>
</div>
<div id="lstnumberx266" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">container</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">push_back</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(42);</span>
</div>
<div id="lstnumberx267" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">container</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">push_back</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(17);</span>
</div>
<div id="lstnumberx268" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span>
</div>
<div id="lstnumberx269" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">if</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">auto</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">val</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">container</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">get</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">uint32_t</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;(0))</span>
</div>
<div id="lstnumberx270" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">cout</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;&lt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">*</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">val</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;&lt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_string ltx_font_typewriter" style="font-size:90%;color:#FF0000;">’\n’</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
</div>
</div>
<div id="S7.p5" class="ltx_para">
<p class="ltx_p">The type erasure preserves zero-copy semantics internally while providing dynamic dispatch at container boundaries.</p>
</div>
</section>
<section id="S8" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">8 </span>Algorithms and Parallel Processing</h2>

<div id="S8.p1" class="ltx_para">
<p class="ltx_p">The library provides algorithms optimized for packed data, exploiting the zero-copy invariant.</p>
</div>
<section id="S8.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">8.1 </span>Zero-Copy Transform</h3>

<div id="S8.SS1.p1" class="ltx_para">
<p class="ltx_p">A transform that produces new packed containers:</p>
</div>
<div id="S8.SS1.p2" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,dGVtcGxhdGU8UGFja2VkVmFsdWUgSW5wdXQsIHR5cGVuYW1lIEY+CmF1dG8gcGFja2VkX3RyYW5zZm9ybShjb25zdCBQYWNrZWRDb250YWluZXI8SW5wdXQ+JiBpbnB1dCwgRiYmIGYpIHsKICAgIHVzaW5nIE91dHB1dFZhbHVlID0gZGVjbHR5cGUoZigKICAgICAgICBzdGQ6OmRlY2x2YWw8dHlwZW5hbWUgSW5wdXQ6OnZhbHVlX3R5cGU+KCkpKTsKICAgIHVzaW5nIE91dHB1dCA9IFBhY2tlZDxPdXRwdXRWYWx1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlbmFtZSBJbnB1dDo6Y29kZWNfdHlwZT47CgogICAgUGFja2VkQ29udGFpbmVyPE91dHB1dD4gcmVzdWx0OwogICAgcmVzdWx0LnJlc2VydmUoaW5wdXQuc2l6ZSgpKTsKCiAgICBmb3IgKHNpemVfdCBpID0gMDsgaSA8IGlucHV0LnNpemUoKTsgKytpKQogICAgICAgIHJlc3VsdC5wdXNoX2JhY2soT3V0cHV0e2YoaW5wdXRbaV0pfSk7CgogICAgcmV0dXJuIHJlc3VsdDsKfQ==" download="">⬇</a></div>
<div id="lstnumberx271" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedValue</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Input</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">F</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx272" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">auto</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">packed_transform</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">const</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedContainer</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Input</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">input</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">F</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">f</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx273" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">using</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">OutputValue</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">decltype</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">f</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span>
</div>
<div id="lstnumberx274" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">declval</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Input</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value_type</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;()));</span>
</div>
<div id="lstnumberx275" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">using</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Output</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Packed</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">OutputValue</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span>
</div>
<div id="lstnumberx276" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">                          </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Input</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">codec_type</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;;</span>
</div>
<div id="lstnumberx277" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span>
</div>
<div id="lstnumberx278" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedContainer</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Output</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">result</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx279" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">9</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">result</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">reserve</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">input</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">size</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">());</span>
</div>
<div id="lstnumberx280" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">10</span>
</div>
<div id="lstnumberx281" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">11</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">for</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">size_t</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">i</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">0;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">i</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">input</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">size</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">();</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">++</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">i</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span>
</div>
<div id="lstnumberx282" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">12</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">result</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">push_back</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Output</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">f</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">input</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">[</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">i</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">])});</span>
</div>
<div id="lstnumberx283" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">13</span>
</div>
<div id="lstnumberx284" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">14</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">return</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">result</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx285" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">15</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
</div>
</div>
<div id="S8.SS1.p3" class="ltx_para">
<p class="ltx_p">Each element is decoded exactly once, transformed, then re-encoded. The result container uses the same codec, maintaining compression.</p>
</div>
</section>
<section id="S8.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">8.2 </span>Parallel Algorithms</h3>

<div id="S8.SS2.p1" class="ltx_para">
<p class="ltx_p">Support for C++17 execution policies:</p>
</div>
<div id="S8.SS2.p2" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,dGVtcGxhdGU8dHlwZW5hbWUgRXhlY1BvbGljeSwgUGFja2VkVmFsdWUgSW5wdXQsIHR5cGVuYW1lIEY+CmF1dG8gcGFja2VkX3RyYW5zZm9ybV9wYXIoRXhlY1BvbGljeSYmIHBvbGljeSwKICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IFBhY2tlZENvbnRhaW5lcjxJbnB1dD4mIGlucHV0LAogICAgICAgICAgICAgICAgICAgICAgICAgRiYmIGYpIHsKICAgIC8vIERlY29kZSBpbiBwYXJhbGxlbAogICAgc3RkOjp2ZWN0b3I8dHlwZW5hbWUgSW5wdXQ6OnZhbHVlX3R5cGU+IHRlbXAoaW5wdXQuc2l6ZSgpKTsKICAgIHN0ZDo6dHJhbnNmb3JtKHBvbGljeSwgaW5wdXQuYmVnaW4oKSwgaW5wdXQuZW5kKCksCiAgICAgICAgICAgICAgICAgIHRlbXAuYmVnaW4oKSwKICAgICAgICAgICAgICAgICAgWyZdKGNvbnN0IGF1dG8mIHByb3h5KSB7IHJldHVybiBmKHByb3h5KTsgfSk7CgogICAgLy8gUmUtZW5jb2RlIHNlcXVlbnRpYWxseSAoZm9yIG5vdykKICAgIFBhY2tlZENvbnRhaW5lcjxPdXRwdXQ+IHJlc3VsdDsKICAgIGZvciAoY29uc3QgYXV0byYgdmFsIDogdGVtcCkKICAgICAgICByZXN1bHQucHVzaF9iYWNrKE91dHB1dHt2YWx9KTsKCiAgICByZXR1cm4gcmVzdWx0Owp9" download="">⬇</a></div>
<div id="lstnumberx286" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">ExecPolicy</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedValue</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Input</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">F</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx287" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">auto</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">packed_transform_par</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">ExecPolicy</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">policy</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span>
</div>
<div id="lstnumberx288" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">                         </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">const</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedContainer</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Input</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">input</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span>
</div>
<div id="lstnumberx289" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">                         </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">F</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">f</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx290" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Decode<span class="ltx_text ltx_lst_space"> </span>in<span class="ltx_text ltx_lst_space"> </span>parallel</span>
</div>
<div id="lstnumberx291" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">vector</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Input</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value_type</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">temp</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">input</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">size</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">());</span>
</div>
<div id="lstnumberx292" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">transform</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">policy</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">input</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">begin</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(),</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">input</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">end</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(),</span>
</div>
<div id="lstnumberx293" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">                  </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">temp</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">begin</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(),</span>
</div>
<div id="lstnumberx294" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">9</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">                  </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">[&amp;](</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">const</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">auto</span></span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">proxy</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">return</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">f</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">proxy</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">});</span>
</div>
<div id="lstnumberx295" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">10</span>
</div>
<div id="lstnumberx296" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">11</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Re-encode<span class="ltx_text ltx_lst_space"> </span>sequentially<span class="ltx_text ltx_lst_space"> </span>(for<span class="ltx_text ltx_lst_space"> </span>now)</span>
</div>
<div id="lstnumberx297" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">12</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedContainer</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Output</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">result</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx298" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">13</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">for</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">const</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">auto</span></span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">val</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">:</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">temp</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span>
</div>
<div id="lstnumberx299" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">14</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">result</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">push_back</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Output</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">val</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">});</span>
</div>
<div id="lstnumberx300" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">15</span>
</div>
<div id="lstnumberx301" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">16</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">return</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">result</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx302" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">17</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
</div>
</div>
<div id="S8.SS2.p3" class="ltx_para">
<p class="ltx_p">Decoding parallelizes naturally since elements are independent. Re-encoding could be parallelized by pre-computing offsets, at the cost of additional complexity.</p>
</div>
</section>
<section id="S8.SS3" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">8.3 </span>Specialized Algorithms</h3>

<div id="S8.SS3.p1" class="ltx_para">
<p class="ltx_p">Some algorithms exploit encoding properties. For sorted data with unsigned integers and monotonic codecs (like Elias codes), lexicographic byte order equals numeric order. This enables sorting the compressed representation directly:</p>
</div>
<div id="S8.SS3.p2" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,dGVtcGxhdGU8dHlwZW5hbWUgQ29kZWM+CnZvaWQgc29ydChQYWNrZWRDb250YWluZXI8UGFja2VkPHVpbnQzMl90LCBDb2RlYz4+JiBjb250YWluZXIpIHsKICAgIGlmIGNvbnN0ZXhwciAoY29kZWNfcHJlc2VydmVzX29yZGVyPENvZGVjPikgewogICAgICAgIC8vIFNvcnQgY29tcHJlc3NlZCBieXRlcyBkaXJlY3RseSAtIHplcm8gZGVjb2RlIG92ZXJoZWFkIQogICAgICAgIHN0ZDo6c29ydChjb250YWluZXIucmF3X2JlZ2luKCksIGNvbnRhaW5lci5yYXdfZW5kKCkpOwogICAgfSBlbHNlIHsKICAgICAgICAvLyBGYWxsIGJhY2sgdG8gZGVjb2RlLXNvcnQtZW5jb2RlCiAgICAgICAgLy8gLi4uCiAgICB9Cn0=" download="">⬇</a></div>
<div id="lstnumberx303" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Codec</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx304" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">void</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sort</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedContainer</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Packed</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">uint32_t</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Codec</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;&gt;&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">container</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx305" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">if</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">constexpr</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">codec_preserves_order</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Codec</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx306" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Sort<span class="ltx_text ltx_lst_space"> </span>compressed<span class="ltx_text ltx_lst_space"> </span>bytes<span class="ltx_text ltx_lst_space"> </span>directly<span class="ltx_text ltx_lst_space"> </span>-<span class="ltx_text ltx_lst_space"> </span>zero<span class="ltx_text ltx_lst_space"> </span>decode<span class="ltx_text ltx_lst_space"> </span>overhead!</span>
</div>
<div id="lstnumberx307" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sort</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">container</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">raw_begin</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(),</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">container</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">raw_end</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">());</span>
</div>
<div id="lstnumberx308" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">else</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx309" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Fall<span class="ltx_text ltx_lst_space"> </span>back<span class="ltx_text ltx_lst_space"> </span>to<span class="ltx_text ltx_lst_space"> </span>decode-sort-encode</span>
</div>
<div id="lstnumberx310" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>...</span>
</div>
<div id="lstnumberx311" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">9</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx312" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">10</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
</div>
</div>
<div id="S8.SS3.p3" class="ltx_para">
<p class="ltx_p">This optimization is significant: sorting compressed data without decompression.</p>
</div>
</section>
</section>
<section id="S9" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">9 </span>Implementation Techniques</h2>

<div id="S9.p1" class="ltx_para">
<p class="ltx_p">Several techniques enable the library’s efficiency and expressiveness.</p>
</div>
<section id="S9.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">9.1 </span>Compile-Time Codec Composition</h3>

<div id="S9.SS1.p1" class="ltx_para">
<p class="ltx_p">Codecs compose through templates:</p>
</div>
<div id="S9.SS1.p2" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,Ly8gU2lnbmVkIGludGVnZXJzIHZpYSB6aWd6YWcgZW5jb2RpbmcKdGVtcGxhdGU8dHlwZW5hbWUgVW5zaWduZWRDb2RlYz4Kc3RydWN0IFNpZ25lZCB7CiAgICB0ZW1wbGF0ZTxzdGQ6OnNpZ25lZF9pbnRlZ3JhbCBUPgogICAgc3RhdGljIHZvaWQgZW5jb2RlKFQgdmFsdWUsIGF1dG8mIHNpbmspIHsKICAgICAgICB1c2luZyBVID0gc3RkOjptYWtlX3Vuc2lnbmVkX3Q8VD47CiAgICAgICAgVSBlbmNvZGVkID0gKHZhbHVlIDwgMCkgPwogICAgICAgICAgICAoKC12YWx1ZSkgKiAyIC0gMSkgOiAodmFsdWUgKiAyKTsKICAgICAgICBVbnNpZ25lZENvZGVjOjplbmNvZGUoZW5jb2RlZCwgc2luayk7CiAgICB9CiAgICAvLyAuLi4KfTsKCnVzaW5nIFNpZ25lZEdhbW1hID0gU2lnbmVkPEVsaWFzR2FtbWE+Owp1c2luZyBTaWduZWREZWx0YSA9IFNpZ25lZDxFbGlhc0RlbHRhPjs=" download="">⬇</a></div>
<div id="lstnumberx313" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>Signed<span class="ltx_text ltx_lst_space"> </span>integers<span class="ltx_text ltx_lst_space"> </span>via<span class="ltx_text ltx_lst_space"> </span>zigzag<span class="ltx_text ltx_lst_space"> </span>encoding</span>
</div>
<div id="lstnumberx314" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">UnsignedCodec</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx315" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">struct</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Signed</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx316" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">signed_integral</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx317" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">static</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">void</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">auto</span></span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx318" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">using</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">U</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">make_unsigned_t</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;;</span>
</div>
<div id="lstnumberx319" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">U</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encoded</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">0)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">?</span>
</div>
<div id="lstnumberx320" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">            </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">((-</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">*</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">2</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">-</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">1)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">:</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">*</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">2);</span>
</div>
<div id="lstnumberx321" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">9</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">        </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">UnsignedCodec</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encoded</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">sink</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">);</span>
</div>
<div id="lstnumberx322" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">10</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span>
</div>
<div id="lstnumberx323" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">11</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_comment ltx_font_typewriter" style="font-size:90%;color:#808080;">//<span class="ltx_text ltx_lst_space"> </span>...</span>
</div>
<div id="lstnumberx324" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">12</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">};</span>
</div>
<div id="lstnumberx325" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">13</span>
</div>
<div id="lstnumberx326" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">14</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">using</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">SignedGamma</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Signed</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">EliasGamma</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;;</span>
</div>
<div id="lstnumberx327" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">15</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">using</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">SignedDelta</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">Signed</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">EliasDelta</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;;</span>
</div>
</div>
</div>
<div id="S9.SS1.p3" class="ltx_para">
<p class="ltx_p">The compiler inlines through multiple codec layers, producing optimal code with zero overhead.</p>
</div>
</section>
<section id="S9.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">9.2 </span>Concept-Based Constraints</h3>

<div id="S9.SS2.p1" class="ltx_para">
<p class="ltx_p">C++20 concepts provide clear error messages and enable SFINAE-like behavior:</p>
</div>
<div id="S9.SS2.p2" class="ltx_para">
<div class="ltx_listing ltx_lst_language_C++ ltx_lst_numbers_left ltx_lstlisting ltx_framed ltx_framed_rectangle ltx_listing">
<div class="ltx_listing_data"><a href="data:text/plain;base64,dGVtcGxhdGU8dHlwZW5hbWUgVD4KY29uY2VwdCBQYWNrZWRWYWx1ZSA9IHJlcXVpcmVzKGNvbnN0IFQmIHAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCaXRXcml0ZXImIHcsIEJpdFJlYWRlciYgcikgewogICAgdHlwZW5hbWUgVDo6dmFsdWVfdHlwZTsKICAgIHsgVDo6ZW5jb2RlKHAsIHcpIH0gLT4gc3RkOjpzYW1lX2FzPHZvaWQ+OwogICAgeyBUOjpkZWNvZGUocikgfSAtPiBzdGQ6OnNhbWVfYXM8VD47CiAgICB7IHAudmFsdWUoKSB9IC0+IHN0ZDo6Y29udmVydGlibGVfdG88dHlwZW5hbWUgVDo6dmFsdWVfdHlwZT47Cn07" download="">⬇</a></div>
<div id="lstnumberx328" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">1</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">template</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;</span>
</div>
<div id="lstnumberx329" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">2</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">concept</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">PackedValue</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">=</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">requires</span></span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">const</span></span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">p</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span>
</div>
<div id="lstnumberx330" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">3</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">                               </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">BitWriter</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">w</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">BitReader</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&amp;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">r</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span>
</div>
<div id="lstnumberx331" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">4</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value_type</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">;</span>
</div>
<div id="lstnumberx332" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">5</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">encode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">p</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">,</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">w</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">-&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">same_as</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_keyword ltx_font_typewriter" style="font-size:90%;"><span class="ltx_text" style="color:#0000FF;">void</span></span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;;</span>
</div>
<div id="lstnumberx333" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">6</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">decode</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">(</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">r</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">)</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">-&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">same_as</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;;</span>
</div>
<div id="lstnumberx334" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">7</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;">    </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">{</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">p</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">.</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">()</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">}</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">-&gt;</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">std</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">convertible_to</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&lt;</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">typename</span><span class="ltx_text ltx_lst_space ltx_font_typewriter" style="font-size:90%;"> </span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">T</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">::</span><span class="ltx_text ltx_lst_identifier ltx_font_typewriter" style="font-size:90%;">value_type</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">&gt;;</span>
</div>
<div id="lstnumberx335" class="ltx_listingline">
<span class="ltx_tag ltx_tag_listingline">8</span><span class="ltx_text ltx_font_typewriter" style="font-size:90%;">};</span>
</div>
</div>
</div>
<div id="S9.SS2.p3" class="ltx_para">
<p class="ltx_p">This documents requirements explicitly and prevents invalid compositions at compile time.</p>
</div>
</section>
<section id="S9.SS3" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">9.3 </span>Memory Layout Optimization</h3>

<div id="S9.SS3.p1" class="ltx_para">
<p class="ltx_p">The offset vector enables <math id="S9.SS3.p1.m1" class="ltx_Math" alttext="O(1)" display="inline"><mrow><mi>O</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mrow></math> random access but adds space overhead. For <math id="S9.SS3.p1.m2" class="ltx_Math" alttext="n" display="inline"><mi>n</mi></math> elements with average size <math id="S9.SS3.p1.m3" class="ltx_Math" alttext="b" display="inline"><mi>b</mi></math> bits, total storage is:</p>
</div>
<div id="S9.SS3.p2" class="ltx_para">
<table id="S9.E1" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S9.E1.m1" class="ltx_Math" alttext="S=\frac{nb}{8}+n\times sizeof(size\_t)" display="block"><mrow><mi>S</mi><mo>=</mo><mrow><mfrac><mrow><mi>n</mi><mo>⁢</mo><mi>b</mi></mrow><mn>8</mn></mfrac><mo>+</mo><mrow><mrow><mi>n</mi><mo lspace="0.222em" rspace="0.222em">×</mo><mi>s</mi></mrow><mo>⁢</mo><mi>i</mi><mo>⁢</mo><mi>z</mi><mo>⁢</mo><mi>e</mi><mo>⁢</mo><mi>o</mi><mo>⁢</mo><mi>f</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mrow><mi>s</mi><mo>⁢</mo><mi>i</mi><mo>⁢</mo><mi>z</mi><mo>⁢</mo><mi>e</mi><mo>⁢</mo><mi mathvariant="normal">_</mi><mo>⁢</mo><mi>t</mi></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td rowspan="1" class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right"><span class="ltx_tag ltx_tag_equation ltx_align_right">(1)</span></td>
</tr></tbody>
</table>
</div>
<div id="S9.SS3.p3" class="ltx_para">
<p class="ltx_p">The overhead becomes negligible when <math id="S9.SS3.p3.m1" class="ltx_Math" alttext="b\gg 8\times sizeof(size\_t)" display="inline"><mrow><mi>b</mi><mo>≫</mo><mrow><mrow><mn>8</mn><mo lspace="0.222em" rspace="0.222em">×</mo><mi>s</mi></mrow><mo>⁢</mo><mi>i</mi><mo>⁢</mo><mi>z</mi><mo>⁢</mo><mi>e</mi><mo>⁢</mo><mi>o</mi><mo>⁢</mo><mi>f</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mrow><mi>s</mi><mo>⁢</mo><mi>i</mi><mo>⁢</mo><mi>z</mi><mo>⁢</mo><mi>e</mi><mo>⁢</mo><mi mathvariant="normal">_</mi><mo>⁢</mo><mi>t</mi></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow></math>, typically when average element size exceeds 64 bits (for 64-bit systems). For smaller elements, the compression ratio must exceed <math id="S9.SS3.p3.m2" class="ltx_Math" alttext="8\times sizeof(size\_t)/b" display="inline"><mrow><mrow><mrow><mn>8</mn><mo lspace="0.222em" rspace="0.222em">×</mo><mi>s</mi></mrow><mo>⁢</mo><mi>i</mi><mo>⁢</mo><mi>z</mi><mo>⁢</mo><mi>e</mi><mo>⁢</mo><mi>o</mi><mo>⁢</mo><mi>f</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mrow><mi>s</mi><mo>⁢</mo><mi>i</mi><mo>⁢</mo><mi>z</mi><mo>⁢</mo><mi>e</mi><mo>⁢</mo><mi mathvariant="normal">_</mi><mo>⁢</mo><mi>t</mi></mrow><mo stretchy="false">)</mo></mrow></mrow><mo>/</mo><mi>b</mi></mrow></math> to benefit.</p>
</div>
<div id="S9.SS3.p4" class="ltx_para">
<p class="ltx_p">Alternative designs trade access time for space. A container without offsets requires linear scan for access but eliminates overhead entirely, suitable for sequential-only workloads.</p>
</div>
</section>
</section>
<section id="S10" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">10 </span>Performance Analysis</h2>

<div id="S10.p1" class="ltx_para">
<p class="ltx_p">We analyze both compression effectiveness and runtime performance.</p>
</div>
<section id="S10.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">10.1 </span>Compression Ratios</h3>

<div id="S10.SS1.p1" class="ltx_para">
<p class="ltx_p">For geometric distributions with parameter <math id="S10.SS1.p1.m1" class="ltx_Math" alttext="p" display="inline"><mi>p</mi></math>, Elias Gamma achieves expected length:</p>
</div>
<div id="S10.SS1.p2" class="ltx_para">
<table id="S10.E2" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S10.E2.m1" class="ltx_Math" alttext="E[L_{\gamma}(X)]=2\log_{2}(1/p)+O(1)" display="block"><mrow><mrow><mi>E</mi><mo>⁢</mo><mrow><mo stretchy="false">[</mo><mrow><msub><mi>L</mi><mi>γ</mi></msub><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow></mrow><mo>=</mo><mrow><mrow><mn>2</mn><mo lspace="0.167em">⁢</mo><mrow><msub><mi>log</mi><mn>2</mn></msub><mo>⁡</mo><mrow><mo stretchy="false">(</mo><mrow><mn>1</mn><mo>/</mo><mi>p</mi></mrow><mo stretchy="false">)</mo></mrow></mrow></mrow><mo>+</mo><mrow><mi>O</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mrow></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td rowspan="1" class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right"><span class="ltx_tag ltx_tag_equation ltx_align_right">(2)</span></td>
</tr></tbody>
</table>
</div>
<div id="S10.SS1.p3" class="ltx_para">
<p class="ltx_p">For <math id="S10.SS1.p3.m1" class="ltx_Math" alttext="p=0.1" display="inline"><mrow><mi>p</mi><mo>=</mo><mn>0.1</mn></mrow></math> (mean value 10), this gives approximately 3.3 bits per value, compared to 32 bits for standard representation—a 9.7× compression ratio.</p>
</div>
<div id="S10.SS1.p4" class="ltx_para">
<p class="ltx_p">Rice codes with optimal parameter <math id="S10.SS1.p4.m1" class="ltx_Math" alttext="k=\lceil-\log_{2}p\rceil" display="inline"><mrow><mi>k</mi><mo>=</mo><mrow><mo stretchy="false">⌈</mo><mrow><mo rspace="0.167em">−</mo><mrow><msub><mi>log</mi><mn>2</mn></msub><mo lspace="0.167em">⁡</mo><mi>p</mi></mrow></mrow><mo stretchy="false">⌉</mo></mrow></mrow></math> achieve:</p>
</div>
<div id="S10.SS1.p5" class="ltx_para">
<table id="S10.E3" class="ltx_equation ltx_eqn_table">

<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math id="S10.E3.m1" class="ltx_Math" alttext="E[L_{Rice}(X)]=\frac{1}{p}+k" display="block"><mrow><mrow><mi>E</mi><mo>⁢</mo><mrow><mo stretchy="false">[</mo><mrow><msub><mi>L</mi><mrow><mi>R</mi><mo>⁢</mo><mi>i</mi><mo>⁢</mo><mi>c</mi><mo>⁢</mo><mi>e</mi></mrow></msub><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo></mrow></mrow><mo stretchy="false">]</mo></mrow></mrow><mo>=</mo><mrow><mfrac><mn>1</mn><mi>p</mi></mfrac><mo>+</mo><mi>k</mi></mrow></mrow></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td rowspan="1" class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right"><span class="ltx_tag ltx_tag_equation ltx_align_right">(3)</span></td>
</tr></tbody>
</table>
</div>
<div id="S10.SS1.p6" class="ltx_para">
<p class="ltx_p">For geometric distributions, this approaches optimality.</p>
</div>
</section>
<section id="S10.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">10.2 </span>Runtime Performance</h3>

<div id="S10.SS2.p1" class="ltx_para">
<p class="ltx_p">The zero-copy invariant trades CPU for memory. Decoding costs dominate access patterns. For Elias Gamma, decoding requires:</p>
</div>
<div id="S10.SS2.p2" class="ltx_para">
<ul id="S10.I1" class="ltx_itemize">
<li id="S10.I1.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S10.I1.i1.p1" class="ltx_para">
<p class="ltx_p">Count leading zeros: <math id="S10.I1.i1.p1.m1" class="ltx_Math" alttext="O(1)" display="inline"><mrow><mi>O</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mrow></math> with hardware support (<span class="ltx_text ltx_font_typewriter">__builtin_clz</span>)</p>
</div>
</li>
<li id="S10.I1.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span> 
<div id="S10.I1.i2.p1" class="ltx_para">
<p class="ltx_p">Read bits: <math id="S10.I1.i2.p1.m1" class="ltx_Math" alttext="O(\log n)" display="inline"><mrow><mi>O</mi><mo>⁢</mo><mrow><mo stretchy="false">(</mo><mrow><mi>log</mi><mo lspace="0.167em">⁡</mo><mi>n</mi></mrow><mo stretchy="false">)</mo></mrow></mrow></math> for value <math id="S10.I1.i2.p1.m2" class="ltx_Math" alttext="n" display="inline"><mi>n</mi></math></p>
</div>
</li>
</ul>
</div>
<div id="S10.SS2.p3" class="ltx_para">
<p class="ltx_p">Modern processors perform these operations in nanoseconds. For data accessed infrequently or streamed sequentially, the compression benefit outweighs decode cost.</p>
</div>
</section>
<section id="S10.SS3" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">10.3 </span>Benchmarks</h3>

<div id="S10.SS3.p1" class="ltx_para">
<p class="ltx_p">Preliminary benchmarks on an x86-64 system with 1M element containers:</p>
</div>
<figure id="S10.T1" class="ltx_table">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle">
<thead class="ltx_thead">
<tr class="ltx_tr">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_tt">Codec</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_th_row ltx_border_tt">Size (KB)</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_tt">Access Time (ns)</th>
<th class="ltx_td ltx_nopad_r ltx_align_right ltx_th ltx_th_column ltx_border_tt">Compression</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t">Uncompressed</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_row ltx_border_t">4000</th>
<td class="ltx_td ltx_align_right ltx_border_t">2.1</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_t">1.0×</td>
</tr>
<tr class="ltx_tr">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row">Elias Gamma</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_row">412</th>
<td class="ltx_td ltx_align_right">8.7</td>
<td class="ltx_td ltx_nopad_r ltx_align_right">9.7×</td>
</tr>
<tr class="ltx_tr">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row">Elias Delta</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_row">387</th>
<td class="ltx_td ltx_align_right">11.3</td>
<td class="ltx_td ltx_nopad_r ltx_align_right">10.3×</td>
</tr>
<tr class="ltx_tr">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row">Rice (k=3)</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_row">425</th>
<td class="ltx_td ltx_align_right">6.9</td>
<td class="ltx_td ltx_nopad_r ltx_align_right">9.4×</td>
</tr>
<tr class="ltx_tr">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb">Fixed¡16¿</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_row ltx_border_bb">2000</th>
<td class="ltx_td ltx_align_right ltx_border_bb">3.8</td>
<td class="ltx_td ltx_nopad_r ltx_align_right ltx_border_bb">2.0×</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 1: </span>Compression and access performance for geometric distribution with mean 10</figcaption>
</figure>
<div id="S10.SS3.p2" class="ltx_para">
<p class="ltx_p">Access time includes decode overhead. For applications with large datasets fitting in compressed form but not uncompressed (e.g., exceeding cache or RAM capacity), the effective performance gain is substantial.</p>
</div>
</section>
</section>
<section id="S11" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">11 </span>Related Work</h2>

<section id="S11.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">11.1 </span>Universal Coding</h3>

<div id="S11.SS1.p1" class="ltx_para">
<p class="ltx_p">Elias <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib2" title="" class="ltx_ref">2</a>]</cite> introduced the fundamental gamma and delta codes. Rissanen and Langdon <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib4" title="" class="ltx_ref">4</a>]</cite> developed arithmetic coding for optimal compression. Our contribution is not new codes but rather their integration into a type-safe, zero-copy programming model.</p>
</div>
</section>
<section id="S11.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">11.2 </span>Compression Libraries</h3>

<div id="S11.SS2.p1" class="ltx_para">
<p class="ltx_p">Traditional libraries like zlib and LZ4 operate on byte streams, requiring explicit compress/decompress steps. Protocol Buffers <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib5" title="" class="ltx_ref">5</a>]</cite> and FlatBuffers <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib6" title="" class="ltx_ref">6</a>]</cite> provide zero-copy deserialization but require schema compilation and do not support arbitrary composition.</p>
</div>
<div id="S11.SS2.p2" class="ltx_para">
<p class="ltx_p">The most similar work is Cap’n Proto <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib7" title="" class="ltx_ref">7</a>]</cite>, which achieves zero-copy through fixed-width encoding. Our approach extends this to variable-length encodings, achieving better compression at the cost of random access overhead.</p>
</div>
</section>
<section id="S11.SS3" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">11.3 </span>Generic Programming</h3>

<div id="S11.SS3.p1" class="ltx_para">
<p class="ltx_p">Stepanov and McJones <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib1" title="" class="ltx_ref">1</a>]</cite> established the foundations of generic programming in <em class="ltx_emph ltx_font_italic">Elements of Programming</em>. Alexandrescu <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib8" title="" class="ltx_ref">8</a>]</cite> demonstrated advanced template techniques in <em class="ltx_emph ltx_font_italic">Modern C++ Design</em>. We apply these principles to compression, showing that generic programming naturally extends to bit-level data representations.</p>
</div>
<div id="S11.SS3.p2" class="ltx_para">
<p class="ltx_p">The C++ Ranges library <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib9" title="" class="ltx_ref">9</a>]</cite> provides composable views over sequences. Our packed containers and iterators follow similar compositional principles but operate at the bit level rather than element level.</p>
</div>
</section>
<section id="S11.SS4" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">11.4 </span>Type Systems for Compression</h3>

<div id="S11.SS4.p1" class="ltx_para">
<p class="ltx_p">Recent work explores type systems for compression. Zhang et al. <cite class="ltx_cite ltx_citemacro_cite">[<a href="#bib.bib10" title="" class="ltx_ref">10</a>]</cite> present a Haskell library for typed binary formats. Our work differs in maintaining the zero-copy invariant: we do not separate encoded and decoded representations.</p>
</div>
</section>
</section>
<section id="S12" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">12 </span>Limitations and Future Work</h2>

<section id="S12.SS1" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">12.1 </span>Current Limitations</h3>

<div id="S12.SS1.p1" class="ltx_para">
<ol id="S12.I1" class="ltx_enumerate">
<li id="S12.I1.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">1.</span> 
<div id="S12.I1.i1.p1" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Random access overhead</span>: The offset vector adds memory overhead proportional to element count. For very small elements or huge containers, this may dominate.</p>
</div>
</li>
<li id="S12.I1.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">2.</span> 
<div id="S12.I1.i2.p1" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Update performance</span>: Modifying an element requires re-encoding subsequent elements. A sophisticated implementation could use gap buffers or piece tables to amortize this cost.</p>
</div>
</li>
<li id="S12.I1.i3" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">3.</span> 
<div id="S12.I1.i3.p1" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Parallel encoding</span>: While decoding parallelizes naturally, encoding requires sequential offset computation. Parallel prefix sum algorithms could address this.</p>
</div>
</li>
<li id="S12.I1.i4" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">4.</span> 
<div id="S12.I1.i4.p1" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Cache efficiency</span>: Variable-length encoding may reduce spatial locality compared to fixed-width representations.</p>
</div>
</li>
</ol>
</div>
</section>
<section id="S12.SS2" class="ltx_subsection">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">12.2 </span>Future Directions</h3>

<div id="S12.SS2.p1" class="ltx_para">
<p class="ltx_p">Several extensions would enhance the library:</p>
</div>
<div id="S12.SS2.p2" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Adaptive coding</span>: Huffman coding with precomputed or learned tables for specific data distributions.</p>
</div>
<div id="S12.SS2.p3" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Arithmetic coding</span>: For optimal compression when probability distributions are known.</p>
</div>
<div id="S12.SS2.p4" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Dictionary methods</span>: LZ77/LZ78 variants for repetitive data, challenging due to the zero-copy constraint.</p>
</div>
<div id="S12.SS2.p5" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">SIMD optimization</span>: Vector instructions could accelerate encoding/decoding of fixed-width codes.</p>
</div>
<div id="S12.SS2.p6" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Persistent data structures</span>: Copy-on-write semantics could improve update performance for large containers.</p>
</div>
<div id="S12.SS2.p7" class="ltx_para">
<p class="ltx_p"><span class="ltx_text ltx_font_bold">Compile-time format verification</span>: Dependent types or constexpr evaluation to verify codec compatibility at compile time.</p>
</div>
</section>
</section>
<section id="S13" class="ltx_section">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">13 </span>Conclusion</h2>

<div id="S13.p1" class="ltx_para">
<p class="ltx_p">We have presented PFC, a C++20 library demonstrating that data compression and zero-copy access are compatible goals when built on prefix-free codes and generic programming principles. The key insights are:</p>
</div>
<div id="S13.p2" class="ltx_para">
<ol id="S13.I1" class="ltx_enumerate">
<li id="S13.I1.i1" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">1.</span> 
<div id="S13.I1.i1.p1" class="ltx_para">
<p class="ltx_p">The self-delimiting property of prefix-free codes enables composition without delimiters, supporting arbitrary type structures.</p>
</div>
</li>
<li id="S13.I1.i2" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">2.</span> 
<div id="S13.I1.i2.p1" class="ltx_para">
<p class="ltx_p">Generic programming principles (concepts, value semantics, algorithmic abstraction) apply naturally to compressed representations.</p>
</div>
</li>
<li id="S13.I1.i3" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">3.</span> 
<div id="S13.I1.i3.p1" class="ltx_para">
<p class="ltx_p">The zero-copy invariant—in-memory equals on-wire—eliminates marshaling overhead while maintaining type safety.</p>
</div>
</li>
<li id="S13.I1.i4" class="ltx_item" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">4.</span> 
<div id="S13.I1.i4.p1" class="ltx_para">
<p class="ltx_p">Modern C++ features (concepts, templates, constexpr) provide abstraction without runtime cost.</p>
</div>
</li>
</ol>
</div>
<div id="S13.p3" class="ltx_para">
<p class="ltx_p">The library achieves 3-10× compression ratios on typical integer data while integrating seamlessly with the C++ Standard Library. This demonstrates that compression can be an intrinsic type property rather than an external concern, opening new architectural possibilities for memory-constrained applications.</p>
</div>
<div id="S13.p4" class="ltx_para">
<p class="ltx_p">The complete library, including all source code and examples, is available at <span class="ltx_text ltx_font_typewriter">https://github.com/spinoza/pfc</span> under the MIT license.</p>
</div>
</section>
<section id="Sx1" class="ltx_section">
<h2 class="ltx_title ltx_title_section">Acknowledgments</h2>

<div id="Sx1.p1" class="ltx_para">
<p class="ltx_p">This work builds on the foundations laid by Alex Stepanov in generic programming and the extensive research in universal coding theory. We thank the C++ standards committee for concepts and other modern language features that made this design possible.</p>
</div>
</section>
<section id="bib" class="ltx_bibliography">
<h2 class="ltx_title ltx_title_bibliography">References</h2>

<ul class="ltx_biblist">
<li id="bib.bib1" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[1]</span>
<span class="ltx_bibblock">
A. Stepanov and P. McJones,
<em class="ltx_emph ltx_font_italic">Elements of Programming</em>,
Addison-Wesley, 2009.

</span>
</li>
<li id="bib.bib2" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[2]</span>
<span class="ltx_bibblock">
P. Elias,
“Universal codeword sets and representations of the integers,”
<em class="ltx_emph ltx_font_italic">IEEE Transactions on Information Theory</em>, vol. 21, no. 2, pp. 194–203, 1975.

</span>
</li>
<li id="bib.bib3" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[3]</span>
<span class="ltx_bibblock">
J. Rissanen,
“Generalized Kraft inequality and arithmetic coding,”
<em class="ltx_emph ltx_font_italic">IBM Journal of Research and Development</em>, vol. 20, no. 3, pp. 198–203, 1976.

</span>
</li>
<li id="bib.bib4" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[4]</span>
<span class="ltx_bibblock">
J. Rissanen and G. Langdon,
“Arithmetic coding,”
<em class="ltx_emph ltx_font_italic">IBM Journal of Research and Development</em>, vol. 23, no. 2, pp. 149–162, 1981.

</span>
</li>
<li id="bib.bib5" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[5]</span>
<span class="ltx_bibblock">
Google,
“Protocol Buffers,”
<a href="https://developers.google.com/protocol-buffers" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://developers.google.com/protocol-buffers</a>, 2023.

</span>
</li>
<li id="bib.bib6" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[6]</span>
<span class="ltx_bibblock">
Google,
“FlatBuffers: Memory Efficient Serialization Library,”
<a href="https://google.github.io/flatbuffers/" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://google.github.io/flatbuffers/</a>, 2023.

</span>
</li>
<li id="bib.bib7" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[7]</span>
<span class="ltx_bibblock">
K. Varda,
“Cap’n Proto: Insanely fast data serialization format,”
<a href="https://capnproto.org/" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://capnproto.org/</a>, 2023.

</span>
</li>
<li id="bib.bib8" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[8]</span>
<span class="ltx_bibblock">
A. Alexandrescu,
<em class="ltx_emph ltx_font_italic">Modern C++ Design: Generic Programming and Design Patterns Applied</em>,
Addison-Wesley, 2001.

</span>
</li>
<li id="bib.bib9" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[9]</span>
<span class="ltx_bibblock">
E. Niebler, C. Carter, and C. Di Bella,
“A brief introduction to C++ ranges,”
<a href="https://www.modernescpp.com/index.php/c-20-ranges-library" title="" class="ltx_ref ltx_url ltx_font_typewriter">https://www.modernescpp.com/index.php/c-20-ranges-library</a>, 2018.

</span>
</li>
<li id="bib.bib10" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[10]</span>
<span class="ltx_bibblock">
L. Zhang, A. Chattopadhyay, and C. Wang,
“Type-safe and efficient binary formats in Haskell,”
<em class="ltx_emph ltx_font_italic">Proceedings of the Haskell Symposium</em>, pp. 14–26, 2017.

</span>
</li>
<li id="bib.bib11" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[11]</span>
<span class="ltx_bibblock">
T. Cover and J. Thomas,
<em class="ltx_emph ltx_font_italic">Elements of Information Theory</em>,
2nd ed., Wiley, 2006.

</span>
</li>
<li id="bib.bib12" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[12]</span>
<span class="ltx_bibblock">
D. Salomon,
<em class="ltx_emph ltx_font_italic">Data Compression: The Complete Reference</em>,
4th ed., Springer, 2007.

</span>
</li>
<li id="bib.bib13" class="ltx_bibitem">
<span class="ltx_tag ltx_tag_bibitem">[13]</span>
<span class="ltx_bibblock">
I. Witten, A. Moffat, and T. Bell,
<em class="ltx_emph ltx_font_italic">Managing Gigabytes: Compressing and Indexing Documents and Images</em>,
2nd ed., Morgan Kaufmann, 1999.

</span>
</li>
</ul>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Wed Oct  1 23:11:14 2025 by <a href="http://dlmf.nist.gov/LaTeXML/" class="ltx_LaTeXML_logo"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg==" alt="Mascot Sammy"></a>
</div></footer>
</div>
</div>
<script>
/* Component JS: reading-time */
// Reading Time Component JavaScript
(function() {
    'use strict';

    function initReadingTime() {
        // Calculate reading time
        const readingStats = calculateReadingTime();

        if (!readingStats.words || readingStats.words === 0) {
            return; // No content found
        }

        // Create reading time element
        const readingTime = document.createElement('div');
        readingTime.className = 'tex2any-reading-time';
        readingTime.setAttribute('role', 'status');
        readingTime.setAttribute('aria-label', 'Estimated reading time: ' + readingStats.minutes + ' minutes');
        readingTime.setAttribute('data-tooltip', readingStats.words + ' words');

        // Progress indicator
        const progressDot = document.createElement('span');
        progressDot.className = 'tex2any-reading-time-progress not-started';
        progressDot.setAttribute('aria-hidden', 'true');

        // Clock icon
        const icon = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        icon.setAttribute('viewBox', '0 0 24 24');
        icon.setAttribute('aria-hidden', 'true');
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', 'M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.2 3.2.8-1.3-4.5-2.7V7z');
        icon.appendChild(path);

        // Text
        const text = document.createElement('span');
        text.className = 'tex2any-reading-time-text';
        text.textContent = readingStats.minutes + ' min read';

        // Assemble
        readingTime.appendChild(progressDot);
        readingTime.appendChild(icon);
        readingTime.appendChild(text);

        // Insert into document
        insertReadingTime(readingTime);

        // Track reading progress
        trackReadingProgress(readingTime, progressDot, readingStats.words);
    }

    function calculateReadingTime() {
        // Average reading speed: 200 words per minute
        const wordsPerMinute = 200;

        // Get main content
        const contentSelectors = [
            '.ltx_document',
            'main',
            'article',
            '.tex2any-content-wrapper',
            'body'
        ];

        let contentElement = null;
        for (const selector of contentSelectors) {
            contentElement = document.querySelector(selector);
            if (contentElement) break;
        }

        if (!contentElement) {
            return { words: 0, minutes: 0 };
        }

        // Get text content, excluding certain elements
        const clonedContent = contentElement.cloneNode(true);

        // Remove elements that shouldn't be counted
        const excludeSelectors = [
            'script',
            'style',
            'nav',
            '.tex2any-reading-time',
            '.tex2any-toc',
            '.tex2any-floating-toc',
            '.tex2any-footer',
            '.tex2any-header',
            'code',  // Code is typically read slower
            '.ltx_biblist'  // Bibliography
        ];

        excludeSelectors.forEach(function(selector) {
            const elements = clonedContent.querySelectorAll(selector);
            elements.forEach(function(el) {
                el.remove();
            });
        });

        // Get text content
        const text = clonedContent.textContent || '';

        // Count words
        const words = text.trim().split(/\s+/).filter(function(word) {
            return word.length > 0;
        }).length;

        // Calculate reading time
        const minutes = Math.ceil(words / wordsPerMinute);

        return { words: words, minutes: minutes };
    }

    function insertReadingTime(readingTime) {
        // Try to insert after title
        const titleSelectors = [
            '.ltx_title',
            'h1.ltx_title',
            'article h1',
            'main h1',
            'h1'
        ];

        let titleElement = null;
        for (const selector of titleSelectors) {
            titleElement = document.querySelector(selector);
            if (titleElement) break;
        }

        if (titleElement) {
            // Insert after title
            titleElement.parentNode.insertBefore(readingTime, titleElement.nextSibling);
        } else {
            // Fallback: insert at beginning of content
            const contentWrapper = document.querySelector('.tex2any-content-wrapper') ||
                                 document.querySelector('.ltx_document') ||
                                 document.body;

            if (contentWrapper.firstChild) {
                contentWrapper.insertBefore(readingTime, contentWrapper.firstChild);
            } else {
                contentWrapper.appendChild(readingTime);
            }
        }
    }

    function trackReadingProgress(readingTimeElement, progressDot, totalWords) {
        let hasStarted = false;
        let hasCompleted = false;

        function updateProgress() {
            const scrolled = window.scrollY;
            const windowHeight = window.innerHeight;
            const documentHeight = document.documentElement.scrollHeight;

            // Calculate progress percentage
            const progress = scrolled / (documentHeight - windowHeight);

            if (progress < 0.1 && !hasStarted) {
                progressDot.className = 'tex2any-reading-time-progress not-started';
            } else if (progress >= 0.9 && !hasCompleted) {
                progressDot.className = 'tex2any-reading-time-progress completed';
                hasCompleted = true;
            } else if (progress >= 0.1) {
                if (!hasStarted) {
                    hasStarted = true;
                }
                progressDot.className = 'tex2any-reading-time-progress in-progress';
            }

            // Update tooltip with remaining time
            if (progress < 1) {
                const wordsRemaining = Math.ceil(totalWords * (1 - progress));
                const minutesRemaining = Math.ceil(wordsRemaining / 200);
                const tooltip = minutesRemaining > 0
                    ? minutesRemaining + ' min remaining'
                    : 'Almost done!';
                readingTimeElement.setAttribute('data-tooltip', tooltip);
            } else {
                readingTimeElement.setAttribute('data-tooltip', 'Reading complete!');
            }
        }

        // Throttle scroll events
        let ticking = false;
        function onScroll() {
            if (!ticking) {
                window.requestAnimationFrame(function() {
                    updateProgress();
                    ticking = false;
                });
                ticking = true;
            }
        }

        // Initial update
        updateProgress();

        // Listen to scroll events
        window.addEventListener('scroll', onScroll, { passive: true });
    }

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initReadingTime);
    } else {
        initReadingTime();
    }
})();

/* Component JS: footer */
// Footer Component JavaScript
(function() {
    'use strict';

    function initFooter() {
        // Get config data from meta tag (injected by Python)
        const configMeta = document.querySelector('meta[name="tex2any-footer-config"]');
        let config = {};

        if (configMeta) {
            try {
                config = JSON.parse(configMeta.getAttribute('content'));
            } catch (e) {
                console.warn('Failed to parse footer config:', e);
            }
        }

        // Create footer
        const footer = document.createElement('footer');
        footer.className = 'tex2any-footer';

        const footerContent = document.createElement('div');
        footerContent.className = 'tex2any-footer-content';

        // Left section - Author info
        if (config.author_name || config.author_email) {
            const authorSection = document.createElement('div');
            authorSection.className = 'tex2any-footer-section';

            const h3 = document.createElement('h3');
            h3.textContent = 'Author';
            authorSection.appendChild(h3);

            if (config.author_name) {
                const p = document.createElement('p');
                p.textContent = config.author_name;
                authorSection.appendChild(p);
            }

            if (config.author_email) {
                const p = document.createElement('p');
                const a = document.createElement('a');
                a.href = 'mailto:' + config.author_email;
                a.textContent = config.author_email;
                p.appendChild(a);
                authorSection.appendChild(p);
            }

            footerContent.appendChild(authorSection);
        }

        // Middle section - Document info
        const docSection = document.createElement('div');
        docSection.className = 'tex2any-footer-section';

        const docTitle = document.querySelector('.ltx_title_document, title');
        if (docTitle) {
            const h3 = document.createElement('h3');
            h3.textContent = 'Document';
            docSection.appendChild(h3);

            const p = document.createElement('p');
            p.textContent = docTitle.textContent || document.title;
            docSection.appendChild(p);

            // Add date if available
            const date = document.querySelector('.ltx_date');
            if (date) {
                const dateP = document.createElement('p');
                dateP.textContent = date.textContent;
                docSection.appendChild(dateP);
            }
        }

        footerContent.appendChild(docSection);

        // Right section - Links
        const linksSection = document.createElement('div');
        linksSection.className = 'tex2any-footer-section';

        const h3 = document.createElement('h3');
        h3.textContent = 'Quick Links';
        linksSection.appendChild(h3);

        const ul = document.createElement('ul');

        // Add link to top
        const topLi = document.createElement('li');
        const topA = document.createElement('a');
        topA.href = '#';
        topA.textContent = 'Back to Top';
        topLi.appendChild(topA);
        ul.appendChild(topLi);

        // Add links to major sections
        const sections = document.querySelectorAll('.ltx_section');
        sections.forEach((section, i) => {
            if (i >= 3) return; // Only show first 3
            const heading = section.querySelector('.ltx_title');
            if (!heading || !section.id) return;

            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#' + section.id;
            a.textContent = heading.textContent.replace(/^\d+\s*/, '');
            li.appendChild(a);
            ul.appendChild(li);
        });

        linksSection.appendChild(ul);
        footerContent.appendChild(linksSection);

        footer.appendChild(footerContent);

        // Bottom bar - Copyright
        const bottom = document.createElement('div');
        bottom.className = 'tex2any-footer-bottom';

        const copyright = document.createElement('div');
        copyright.className = 'tex2any-footer-copyright';

        let copyrightText = '';
        if (config.copyright_year && config.author_name) {
            copyrightText = `© ${config.copyright_year} ${config.author_name}`;
        } else if (config.copyright_year) {
            copyrightText = `© ${config.copyright_year}`;
        } else if (config.author_name) {
            copyrightText = `© ${config.author_name}`;
        }

        if (config.license) {
            copyrightText += copyrightText ? ` • ${config.license}` : config.license;
        }

        if (config.custom_text) {
            copyrightText += copyrightText ? ` • ${config.custom_text}` : config.custom_text;
        }

        if (!copyrightText) {
            copyrightText = 'Generated by tex2any';
        }

        copyright.textContent = copyrightText;
        bottom.appendChild(copyright);

        // Generated by
        const links = document.createElement('div');
        links.className = 'tex2any-footer-links';

        const genLink = document.createElement('a');
        genLink.href = 'https://github.com/yourusername/tex2any';
        genLink.textContent = 'Generated by tex2any';
        links.appendChild(genLink);

        bottom.appendChild(links);
        footer.appendChild(bottom);

        // Append to body
        document.body.appendChild(footer);
    }

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initFooter);
    } else {
        initFooter();
    }
})();

/* Component JS: floating-toc */
// Floating TOC Component JavaScript
(function() {
    'use strict';

    function initFloatingTOC() {
        // Build TOC from document structure
        const sections = document.querySelectorAll('.ltx_section, .ltx_subsection, .ltx_subsubsection');
        if (sections.length === 0) return;

        // Create wrapper
        const wrapper = document.createElement('nav');
        wrapper.className = 'tex2any-floating-toc';
        wrapper.setAttribute('aria-label', 'Table of Contents');

        // Create title
        const title = document.createElement('div');
        title.className = 'tex2any-toc-title';
        title.textContent = 'Contents';
        wrapper.appendChild(title);

        // Build TOC list
        const tocList = document.createElement('ul');
        sections.forEach(section => {
            const heading = section.querySelector('.ltx_title');
            if (!heading || !section.id) return;

            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#' + section.id;

            // Get section text (remove numbering)
            const textNode = Array.from(heading.childNodes)
                .filter(node => node.nodeType === Node.TEXT_NODE || !node.classList.contains('ltx_tag'))
                .map(node => node.textContent)
                .join('');

            a.textContent = textNode.trim();
            li.appendChild(a);

            // Add appropriate class for nesting
            if (section.classList.contains('ltx_subsection')) {
                li.style.paddingLeft = '1rem';
            } else if (section.classList.contains('ltx_subsubsection')) {
                li.style.paddingLeft = '2rem';
            }

            tocList.appendChild(li);
        });

        wrapper.appendChild(tocList);
        document.body.insertBefore(wrapper, document.body.firstChild);

        // Create toggle button
        const toggle = document.createElement('button');
        toggle.className = 'tex2any-floating-toc-toggle';
        toggle.setAttribute('aria-label', 'Toggle Table of Contents');
        toggle.innerHTML = '☰';
        document.body.appendChild(toggle);

        // Add body class
        document.body.classList.add('has-floating-toc');

        // Start with TOC hidden
        let collapsed = true;
        wrapper.classList.add('collapsed');

        // Toggle functionality
        toggle.addEventListener('click', function() {
            collapsed = !collapsed;
            wrapper.classList.toggle('collapsed', collapsed);
            toggle.innerHTML = collapsed ? '☰' : '✕';
        });

        // Highlight current section
        const headings = document.querySelectorAll('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]');
        const tocLinks = wrapper.querySelectorAll('a[href^="#"]');

        function updateActiveTOC() {
            let currentSection = null;
            const scrollPos = window.scrollY + 100;

            headings.forEach(heading => {
                if (heading.offsetTop <= scrollPos) {
                    currentSection = heading;
                }
            });

            tocLinks.forEach(link => {
                link.classList.remove('active');
                if (currentSection && link.getAttribute('href') === '#' + currentSection.id) {
                    link.classList.add('active');
                }
            });
        }

        // Update on scroll
        let scrollTimeout;
        window.addEventListener('scroll', function() {
            if (scrollTimeout) clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(updateActiveTOC, 50);
        });

        // Initial update
        updateActiveTOC();
    }

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initFloatingTOC);
    } else {
        initFloatingTOC();
    }
})();
</script>
</body>
</html>
